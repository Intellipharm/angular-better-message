!function(){"use strict";angular.module("AngularBetterMessage",[])}(),angular.module("AngularBetterMessage",[]).run(["$templateCache",function(s){s.put("html/angular-better-message.html",'<div class="angular-better-message" ng-class="[state, outer_prompt_class]" ng-show="is_visible"><div ng-class="message_class"><span ng-class="message_icon_class"></span> {{message}}&nbsp; <span class="countdown" ng-if="show_count_down">{{count_down}}</span></div><div ng-if="prompt" ng-class="prompt_class"><button ng-class="prompt_button_class" ng-click="ctrl.onClick()">{{prompt}}<span ng-class="prompt_icon_class"></span></button></div></div>')}]),function(){"use strict";var s=function(s){this.onClick=function(){_.isUndefined(s.onClick)||s.onClick({state:s.state}),s.close()}};s.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",s)}(),function(){"use strict";var s=function(s,e,n,t,a){return{restrict:"EA",scope:{api:"=",state:"=",force_change:"=forceChange",message:"=",message_icon_class:"=messageIconClass",prompt:"=",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(o,c,i,l){var r=o.api||{};o.message_class=n,o.prompt_class=t;var u,d,p;o.is_visible=!1;var g,f=angular.element(s);r.close=function(){o.close()},o.close=function(){o.is_visible=!1},o.wait=function(){u=e(function(){0===--o.count_down?(e.cancel(u),o.close()):o.wait()},1e3)},o.checkPosition=function(){o.is_visible&&!c.hasClass("detached")&&_.isNull(c[0].offsetParent)?d=e(o.checkPosition,100):(p=c[0].getBoundingClientRect().top,o.updateDetached())},o.updateDetached=function(){e.cancel(d),!c.hasClass("detached")&&0>=p&&s.pageYOffset>0?(g=s.pageYOffset,c.addClass("detached")):c.hasClass("detached")&&!_.isUndefined(g)&&s.pageYOffset<=g&&c.removeClass("detached")},o.update=function(){o.is_visible=!0,o.fixed_position_on_scroll&&o.checkPosition(),o.count_down=_.parseInt(o.display_seconds),e.cancel(u),_.isUndefined(o.count_down)||0===o.count_down||(o.wait(),o.outer_prompt_class=a)},o.$watch("display_seconds",function(s){_.isUndefined(s)||""===s||(o.display_seconds=_.parseInt(s),o.count_down=_.parseInt(s))}),o.$watch("message",function(s){_.isUndefined(s)||""===s?(e.cancel(u),o.close()):o.update()}),o.$watch("prompt",function(s){o.outer_prompt_class=_.isUndefined(s)||""===s?"":a}),o.$watch("force_change",function(s){_.isUndefined(s)||s&&(o.force_change=!1,o.update())}),o.fixed_position_on_scroll&&f.on("scroll",function(){_.isUndefined(o.message)||""===o.message||o.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};s.$inject=["$window","$timeout","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",s)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLXRlbXBsYXRlcy5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UtY29udHJvbGxlci5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UtZGlyZWN0aXZlLmpzIiwiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS1zZXR0aW5ncy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiLCJjb250cm9sbGVyIiwiJHMiLCJ0aGlzIiwib25DbGljayIsIl8iLCJpc1VuZGVmaW5lZCIsInN0YXRlIiwiY2xvc2UiLCIkaW5qZWN0IiwiZGlyZWN0aXZlIiwiJHdpbmRvdyIsIiR0aW1lb3V0IiwiTUVTU0FHRV9DTEFTUyIsIlBST01QVF9DTEFTUyIsIkhBU19QUk9NUFRfQ0xBU1MiLCJyZXN0cmljdCIsInNjb3BlIiwiYXBpIiwiZm9yY2VfY2hhbmdlIiwibWVzc2FnZSIsIm1lc3NhZ2VfaWNvbl9jbGFzcyIsInByb21wdCIsInByb21wdF9idXR0b25fY2xhc3MiLCJwcm9tcHRfaWNvbl9jbGFzcyIsImRpc3BsYXlfc2Vjb25kcyIsInNob3dfY291bnRfZG93biIsImZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCIsImxpbmsiLCJlbGVtZW50IiwiYXR0cnMiLCJtZXNzYWdlX2NsYXNzIiwicHJvbXB0X2NsYXNzIiwid2FpdF90aW1lciIsImVsZW1lbnRfdmlzaWJsZV90aW1lciIsImVsZW1lbnRfdG9wIiwiaXNfdmlzaWJsZSIsImRldGFjaGVkX3Bvc2l0aW9uIiwid2luZG93X2VsZW1lbnQiLCJ3YWl0IiwiY291bnRfZG93biIsImNhbmNlbCIsImNoZWNrUG9zaXRpb24iLCJoYXNDbGFzcyIsImlzTnVsbCIsIm9mZnNldFBhcmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsInVwZGF0ZURldGFjaGVkIiwicGFnZVlPZmZzZXQiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwidXBkYXRlIiwicGFyc2VJbnQiLCJvdXRlcl9wcm9tcHRfY2xhc3MiLCIkd2F0Y2giLCJ2YWwiLCJvbiIsInJlcGxhY2UiLCJ0ZW1wbGF0ZVVybCIsImNvbnN0YW50Il0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVBLFlBTUFBLFNBQUFDLE9BQUEsOEJDUkFELFFBQUFDLE9BQUEsMkJBQUFDLEtBQUEsaUJBQUEsU0FBQUMsR0FBQUEsRUFBQUMsSUFBQSxtQ0FBQSxvY0NBQSxXQUVBLFlBTUEsSUFBQUMsR0FBQSxTQUFBQyxHQUtBQyxLQUFBQyxRQUFBLFdBQ0FDLEVBQUFDLFlBQUFKLEVBQUFFLFVBQ0FGLEVBQUFFLFNBQUFHLE1BQUFMLEVBQUFLLFFBRUFMLEVBQUFNLFNBSUFQLEdBQUFRLFNBQUEsVUFFQWIsUUFBQUMsT0FBQSx3QkFBQUksV0FBQSwyQkFBQUEsTUN2QkEsV0FFQSxZQU1BLElBQUFTLEdBQUEsU0FDQUMsRUFDQUMsRUFDQUMsRUFDQUMsRUFDQUMsR0FlQSxPQUNBQyxTQUFBLEtBQ0FDLE9BQ0FDLElBQUEsSUFDQVgsTUFBQSxJQUNBWSxhQUFBLGVBQ0FDLFFBQUEsSUFDQUMsbUJBQUEsb0JBQ0FDLE9BQUEsSUFDQUMsb0JBQUEscUJBQ0FDLGtCQUFBLG1CQUNBQyxnQkFBQSxrQkFDQUMsZ0JBQUEsaUJBQ0FDLHlCQUFBLHlCQUNBdkIsUUFBQSxrQkFFQUgsV0FBQSxtQ0FDQTJCLEtBQUEsU0FBQVgsRUFBQVksRUFBQUMsRUFBQTdCLEdBRUEsR0FBQWlCLEdBQUFELEVBQUFDLE9BR0FELEdBQUFjLGNBQUFsQixFQUNBSSxFQUFBZSxhQUFBbEIsQ0FHQSxJQUFBbUIsR0FDQUMsRUFDQUMsQ0FDQWxCLEdBQUFtQixZQUFBLENBR0EsSUFBQUMsR0FDQUMsRUFBQTFDLFFBQUFpQyxRQUFBbEIsRUFNQU8sR0FBQVYsTUFBQSxXQUNBUyxFQUFBVCxTQVVBUyxFQUFBVCxNQUFBLFdBQ0FTLEVBQUFtQixZQUFBLEdBTUFuQixFQUFBc0IsS0FBQSxXQUVBTixFQUFBckIsRUFBQSxXQUVBLE1BQUFLLEVBQUF1QixZQUNBNUIsRUFBQTZCLE9BQUFSLEdBQ0FoQixFQUFBVCxTQUVBUyxFQUFBc0IsUUFFQSxNQU1BdEIsRUFBQXlCLGNBQUEsV0FHQXpCLEVBQUFtQixhQUFBUCxFQUFBYyxTQUFBLGFBQUF0QyxFQUFBdUMsT0FBQWYsRUFBQSxHQUFBZ0IsY0FHQVgsRUFBQXRCLEVBQUFLLEVBQUF5QixjQUFBLE1BSUFQLEVBQUFOLEVBQUEsR0FBQWlCLHdCQUFBQyxJQUdBOUIsRUFBQStCLG1CQU9BL0IsRUFBQStCLGVBQUEsV0FHQXBDLEVBQUE2QixPQUFBUCxJQUdBTCxFQUFBYyxTQUFBLGFBQUEsR0FBQVIsR0FBQXhCLEVBQUFzQyxZQUFBLEdBQ0FaLEVBQUExQixFQUFBc0MsWUFDQXBCLEVBQUFxQixTQUFBLGFBR0FyQixFQUFBYyxTQUFBLGNBQUF0QyxFQUFBQyxZQUFBK0IsSUFBQTFCLEVBQUFzQyxhQUFBWixHQUVBUixFQUFBc0IsWUFBQSxhQU9BbEMsRUFBQW1DLE9BQUEsV0FHQW5DLEVBQUFtQixZQUFBLEVBR0FuQixFQUFBVSwwQkFDQVYsRUFBQXlCLGdCQUlBekIsRUFBQXVCLFdBQUFuQyxFQUFBZ0QsU0FBQXBDLEVBQUFRLGlCQUdBYixFQUFBNkIsT0FBQVIsR0FHQTVCLEVBQUFDLFlBQUFXLEVBQUF1QixhQUFBLElBQUF2QixFQUFBdUIsYUFHQXZCLEVBQUFzQixPQUdBdEIsRUFBQXFDLG1CQUFBdkMsSUFRQUUsRUFBQXNDLE9BQUEsa0JBQUEsU0FBQUMsR0FFQW5ELEVBQUFDLFlBQUFrRCxJQUFBLEtBQUFBLElBQ0F2QyxFQUFBUSxnQkFBQXBCLEVBQUFnRCxTQUFBRyxHQUNBdkMsRUFBQXVCLFdBQUFuQyxFQUFBZ0QsU0FBQUcsTUFJQXZDLEVBQUFzQyxPQUFBLFVBQUEsU0FBQUMsR0FFQW5ELEVBQUFDLFlBQUFrRCxJQUFBLEtBQUFBLEdBR0E1QyxFQUFBNkIsT0FBQVIsR0FDQWhCLEVBQUFULFNBSEFTLEVBQUFtQyxXQU9BbkMsRUFBQXNDLE9BQUEsU0FBQSxTQUFBQyxHQU1BdkMsRUFBQXFDLG1CQUhBakQsRUFBQUMsWUFBQWtELElBQUEsS0FBQUEsRUFHQSxHQUZBekMsSUFNQUUsRUFBQXNDLE9BQUEsZUFBQSxTQUFBQyxHQUdBbkQsRUFBQUMsWUFBQWtELElBQ0FBLElBQ0F2QyxFQUFBRSxjQUFBLEVBQ0FGLEVBQUFtQyxZQVdBbkMsRUFBQVUsMEJBQ0FXLEVBQUFtQixHQUFBLFNBQUEsV0FDQXBELEVBQUFDLFlBQUFXLEVBQUFHLFVBQUEsS0FBQUgsRUFBQUcsU0FHQUgsRUFBQXlCLG1CQUtBZ0IsU0FBQSxFQUNBQyxZQUFBLG9DQUlBakQsR0FBQUQsU0FDQSxVQUNBLFdBQ0EsK0JBQ0Esc0NBQ0EsMkNBR0FiLFFBQUFDLE9BQUEsd0JBQ0FhLFVBQUEsdUJBQUFBLE1DalBBLFdBRUEsWUFNQWQsU0FBQUMsT0FBQSx3QkFDQStELFNBQUEsK0JBQUEsV0FDQUEsU0FBQSxzQ0FBQSxVQUNBQSxTQUFBLDBDQUFBIiwiZmlsZSI6ImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UudG1wbC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2VcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScsIFtdKTtcblxufSkoKTtcbiIsImFuZ3VsYXIubW9kdWxlKFwiQW5ndWxhckJldHRlck1lc3NhZ2VcIiwgW10pLnJ1bihbXCIkdGVtcGxhdGVDYWNoZVwiLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkgeyR0ZW1wbGF0ZUNhY2hlLnB1dChcImh0bWwvYW5ndWxhci1iZXR0ZXItbWVzc2FnZS5odG1sXCIsXCI8ZGl2IGNsYXNzPVxcXCJhbmd1bGFyLWJldHRlci1tZXNzYWdlXFxcIiBuZy1jbGFzcz1cXFwiW3N0YXRlLCBvdXRlcl9wcm9tcHRfY2xhc3NdXFxcIiBuZy1zaG93PVxcXCJpc192aXNpYmxlXFxcIj48ZGl2IG5nLWNsYXNzPVxcXCJtZXNzYWdlX2NsYXNzXFxcIj48c3BhbiBuZy1jbGFzcz1cXFwibWVzc2FnZV9pY29uX2NsYXNzXFxcIj48L3NwYW4+IHt7bWVzc2FnZX19Jm5ic3A7IDxzcGFuIGNsYXNzPVxcXCJjb3VudGRvd25cXFwiIG5nLWlmPVxcXCJzaG93X2NvdW50X2Rvd25cXFwiPnt7Y291bnRfZG93bn19PC9zcGFuPjwvZGl2PjxkaXYgbmctaWY9XFxcInByb21wdFxcXCIgbmctY2xhc3M9XFxcInByb21wdF9jbGFzc1xcXCI+PGJ1dHRvbiBuZy1jbGFzcz1cXFwicHJvbXB0X2J1dHRvbl9jbGFzc1xcXCIgbmctY2xpY2s9XFxcImN0cmwub25DbGljaygpXFxcIj57e3Byb21wdH19PHNwYW4gbmctY2xhc3M9XFxcInByb21wdF9pY29uX2NsYXNzXFxcIj48L3NwYW4+PC9idXR0b24+PC9kaXY+PC9kaXY+XCIpO31dKTsiLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBBbmd1bGFyIEJldHRlciBNZXNzYWdlIGNvbnRyb2xsZXJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIHZhciBjb250cm9sbGVyID0gZnVuY3Rpb24gKCRzKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIG9uQ2xpY2tcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub25DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKCRzLm9uQ2xpY2spKSB7XG4gICAgICAgICAgICAgICAgJHMub25DbGljayh7c3RhdGU6ICRzLnN0YXRlfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZSddO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJykuY29udHJvbGxlcignQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsJywgY29udHJvbGxlcik7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIGFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UgZGlyZWN0aXZlXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YXIgZGlyZWN0aXZlID0gZnVuY3Rpb24oXG4gICAgICAgICR3aW5kb3csXG4gICAgICAgICR0aW1lb3V0LFxuICAgICAgICBNRVNTQUdFX0NMQVNTLFxuICAgICAgICBQUk9NUFRfQ0xBU1MsXG4gICAgICAgIEhBU19QUk9NUFRfQ0xBU1NcbiAgICApIHtcblxuICAgICAgICBmdW5jdGlvbiBnZXRQb3NpdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgeFBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIHZhciB5UG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICB3aGlsZShlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgeFBvc2l0aW9uICs9IChlbGVtZW50Lm9mZnNldExlZnQgLSBlbGVtZW50LnNjcm9sbExlZnQgKyBlbGVtZW50LmNsaWVudExlZnQpO1xuICAgICAgICAgICAgICAgIHlQb3NpdGlvbiArPSAoZWxlbWVudC5vZmZzZXRUb3AgLSBlbGVtZW50LnNjcm9sbFRvcCArIGVsZW1lbnQuY2xpZW50VG9wKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geyB4OiB4UG9zaXRpb24sIHk6IHlQb3NpdGlvbiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBhcGk6ICAgICAgICAgICAgICAgICAgICBcIj1cIixcbiAgICAgICAgICAgICAgICBzdGF0ZTogICAgICAgICAgICAgICAgICBcIj1cIixcbiAgICAgICAgICAgICAgICBmb3JjZV9jaGFuZ2U6ICAgICAgICAgICBcIj1mb3JjZUNoYW5nZVwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICAgICAgICAgICAgICAgIFwiPVwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VfaWNvbl9jbGFzczogICAgIFwiPW1lc3NhZ2VJY29uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBwcm9tcHQ6ICAgICAgICAgICAgICAgICBcIj1cIixcbiAgICAgICAgICAgICAgICBwcm9tcHRfYnV0dG9uX2NsYXNzOiAgICBcIj1wcm9tcHRCdXR0b25DbGFzc1wiLFxuICAgICAgICAgICAgICAgIHByb21wdF9pY29uX2NsYXNzOiAgICAgIFwiPXByb21wdEljb25DbGFzc1wiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlfc2Vjb25kczogICAgICAgIFwiPWRpc3BsYXlTZWNvbmRzXCIsXG4gICAgICAgICAgICAgICAgc2hvd19jb3VudF9kb3duOiAgICAgICAgXCI9c2hvd0NvdW50RG93blwiLFxuICAgICAgICAgICAgICAgIGZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbDogXCI9Zml4ZWRQb3NpdGlvbk9uU2Nyb2xsXCIsXG4gICAgICAgICAgICAgICAgb25DbGljazogICAgICAgICAgICAgICAgXCImb25Qcm9tcHRDbGlja1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbGxlcjogXCJBbmd1bGFyQmV0dGVyTWVzc2FnZUN0cmwgYXMgY3RybFwiLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjb250cm9sbGVyKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgYXBpID0gc2NvcGUuYXBpIHx8IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gY2xhc3Nlc1xuICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2VfY2xhc3MgPSBNRVNTQUdFX0NMQVNTO1xuICAgICAgICAgICAgICAgIHNjb3BlLnByb21wdF9jbGFzcyA9IFBST01QVF9DTEFTUztcblxuICAgICAgICAgICAgICAgIC8vIGNvbnRyb2xcbiAgICAgICAgICAgICAgICB2YXIgd2FpdF90aW1lcjtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF92aXNpYmxlX3RpbWVyO1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50X3RvcDtcbiAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBmaXggb24gc2Nyb2xsXG4gICAgICAgICAgICAgICAgdmFyIGRldGFjaGVkX3Bvc2l0aW9uO1xuICAgICAgICAgICAgICAgIHZhciB3aW5kb3dfZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBhcGlcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICBhcGkuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIHV0aWxzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogY2xvc2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHdhaXRcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS53YWl0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lciA9ICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoLS1zY29wZS5jb3VudF9kb3duID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHdhaXRfdGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndhaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGNoZWNrUG9zaXRpb25cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyB2aXNpYmxlICYgaXMgbm90IGRldGFjaGVkICYgaXMgbm90IHJlYWR5XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pc192aXNpYmxlICYmICFlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmIF8uaXNOdWxsKGVsZW1lbnRbMF0ub2Zmc2V0UGFyZW50KSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3YWl0XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50X3Zpc2libGVfdGltZXIgPSAkdGltZW91dChzY29wZS5jaGVja1Bvc2l0aW9uLCAxMDApO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnZXQgZWxlbWVudCB0b3Agb2Zmc2V0XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50X3RvcCA9IGVsZW1lbnRbMF0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB1cGRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZURldGFjaGVkKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogdXBkYXRlRGV0YWNoZWRcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS51cGRhdGVEZXRhY2hlZCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNhbmNlbCB0aW1lclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwoZWxlbWVudF92aXNpYmxlX3RpbWVyKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGlzIG5vdCBkZXRhY2hlZCBhbmQgaXMgYXQgdGhlIHRvcCBvZiB2aWV3cG9ydCwgdGhlbiBkZXRhY2hcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmIGVsZW1lbnRfdG9wIDw9IDAgJiYgJHdpbmRvdy5wYWdlWU9mZnNldCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaGVkX3Bvc2l0aW9uID0gJHdpbmRvdy5wYWdlWU9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2RldGFjaGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyBkZXRhY2hlZCBhbmQgaXMgYXQgb3IgYWJvdmUgZGV0YWNoZWQgcG9zaXRpb24sIHRoZW4gYXR0YWNoXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnQuaGFzQ2xhc3MoJ2RldGFjaGVkJykgJiYgIV8uaXNVbmRlZmluZWQoZGV0YWNoZWRfcG9zaXRpb24pICYmICR3aW5kb3cucGFnZVlPZmZzZXQgPD0gZGV0YWNoZWRfcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZGV0YWNoZWRfcG9zaXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdkZXRhY2hlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHVwZGF0ZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB2aXNpYmlsaXR5XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzX3Zpc2libGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNoZWNrUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc2V0IGNvdW50IGRvd25cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY291bnRfZG93biA9IF8ucGFyc2VJbnQoc2NvcGUuZGlzcGxheV9zZWNvbmRzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzdG9wIHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHdhaXRfdGltZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGF1dG8gY2xvc2UgYWZ0ZXIgaW50ZXJ2YWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNjb3BlLmNvdW50X2Rvd24pICYmIHNjb3BlLmNvdW50X2Rvd24gIT09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnQgd2FpdFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2FpdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgb3V0ZXIgcHJvbXQgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IEhBU19QUk9NUFRfQ0xBU1M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIHdhdGNoZXJzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkaXNwbGF5X3NlY29uZHMnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRpc3BsYXlfc2Vjb25kcyA9IF8ucGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50X2Rvd24gPSBfLnBhcnNlSW50KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnbWVzc2FnZScsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwod2FpdF90aW1lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3Byb21wdCcsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBvdXRlciBwcm9tdCBjbGFzc1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IEhBU19QUk9NUFRfQ0xBU1M7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2ZvcmNlX2NoYW5nZScsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBvdXRlciBwcm9tdCBjbGFzc1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmZvcmNlX2NoYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gZXZlbnRzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgLy8gd2luZG93IHNjcm9sbFxuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3dfZWxlbWVudC5vbignc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2NvcGUubWVzc2FnZSkgJiYgc2NvcGUubWVzc2FnZSAhPT0gXCJcIikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL2FuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuaHRtbCdcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgZGlyZWN0aXZlLiRpbmplY3QgPSBbXG4gICAgICAgICckd2luZG93JyxcbiAgICAgICAgJyR0aW1lb3V0JyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfQ0xBU1MnLFxuICAgICAgICAnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9QUk9NUFRfQ0xBU1MnLFxuICAgICAgICAnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9IQVNfUFJPTVBUX0NMQVNTJ1xuICAgIF07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnKVxuICAgICAgICAuZGlyZWN0aXZlKCdhbmd1bGFyQmV0dGVyTWVzc2FnZScsIGRpcmVjdGl2ZSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBBbmd1bGFyIEJldHRlciBNZXNzYWdlIHNldHRpbmdzXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfQ0xBU1MnLCAgICAgICAgICAgICAgIFwibWVzc2FnZVwiKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfUFJPTVBUX0NMQVNTJywgICAgICAgIFwicHJvbXB0XCIpXG4gICAgICAgIC5jb25zdGFudCgnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9IQVNfUFJPTVBUX0NMQVNTJywgICAgXCJoYXMtcHJvbXB0XCIpO1xuXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9