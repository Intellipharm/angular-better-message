!function(){"use strict";angular.module("AngularBetterMessage",[])}(),angular.module("AngularBetterMessage",[]).run(["$templateCache",function(e){e.put("html/angular-better-message.html",'<div class="angular-better-message" ng-class="[state, outer_prompt_class]" ng-show="is_visible"><div ng-class="message_class"><span ng-class="message_icon_class"></span> <span class="angular-better-message-wrapper"></span> <span class="countdown" ng-if="show_count_down">{{count_down}}</span></div><div ng-if="prompt" ng-class="prompt_class"><button ng-class="prompt_button_class" ng-click="ctrl.onClick()">{{prompt}} <span ng-class="prompt_icon_class"></span></button></div></div>')}]),function(){"use strict";var e=function(e){this.onClick=function(){if(!_.isUndefined(e.onClick)){var n=_.isUndefined(e.message)?null:e.message,s=_.isUndefined(e.state)?null:e.state,t=_.isUndefined(e.key)?null:e.key,a=_.isUndefined(e.data)?null:e.data;e.onClick({message:n,state:s,key:t,data:a})}e.close()}};e.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",e)}(),function(){"use strict";var e=function(e,n,s,t,a,o){return{restrict:"EA",scope:{api:"=",message:"=",state:"=",key:"=",data:"=",message_icon_class:"=messageIconClass",prompt:"=",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(n,i,l,c){var r=n.api||{};n.message_class=t,n.prompt_class=a;var d,u,p;n.is_visible=!1;var f,g=angular.element(e);r.close=function(){n.close()},r.update=function(){n.update()},n.close=function(){n.is_visible=!1},n.wait=function(){d=window.setInterval(function(){0===--n.count_down?(window.clearInterval(d),n.close()):n.wait()},1e3)},n.checkPosition=function(){n.is_visible&&!i.hasClass("detached")&&_.isNull(i[0].offsetParent)?u=window.setInterval(n.checkPosition,100):(p=i[0].getBoundingClientRect().top,n.updateDetached())},n.updateDetached=function(){window.clearInterval(u),!i.hasClass("detached")&&0>=p&&e.pageYOffset>0?(f=e.pageYOffset,i.addClass("detached")):i.hasClass("detached")&&!_.isUndefined(f)&&e.pageYOffset<=f&&i.removeClass("detached")},n.update=function(){n.is_visible=!0,n.fixed_position_on_scroll&&n.checkPosition(),n.count_down=_.parseInt(n.display_seconds),window.clearInterval(d),_.isUndefined(n.count_down)||0===n.count_down||(n.wait(),n.outer_prompt_class=o)},n.$watch("display_seconds",function(e){_.isUndefined(e)||""===e||(n.display_seconds=_.parseInt(e),n.count_down=_.parseInt(e))}),n.$watch("message",function(e){var t=angular.element(i[0].querySelector(".angular-better-message-wrapper"));if(t.empty(),_.isUndefined(e)||""===e)window.clearInterval(d),n.close();else{var a=s("<span>"+e+"</span>")(n.$parent.$parent);t.append(a),n.update()}}),n.$watch("prompt",function(e){_.isUndefined(e)||""===e?n.outer_prompt_class="":n.outer_prompt_class=o}),n.fixed_position_on_scroll&&g.on("scroll",function(){_.isUndefined(n.message)||""===n.message||n.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};e.$inject=["$window","$timeout","$compile","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",e)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWRpcmVjdGl2ZS5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2Utc2V0dGluZ3MuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkcyIsInRoaXMiLCJvbkNsaWNrIiwiXyIsImlzVW5kZWZpbmVkIiwibWVzc2FnZSIsInN0YXRlIiwia2V5IiwiZGF0YSIsImNsb3NlIiwiJGluamVjdCIsImRpcmVjdGl2ZSIsIiR3aW5kb3ciLCIkdGltZW91dCIsIiRjb21waWxlIiwiTUVTU0FHRV9DTEFTUyIsIlBST01QVF9DTEFTUyIsIkhBU19QUk9NUFRfQ0xBU1MiLCJyZXN0cmljdCIsInNjb3BlIiwiYXBpIiwibWVzc2FnZV9pY29uX2NsYXNzIiwicHJvbXB0IiwicHJvbXB0X2J1dHRvbl9jbGFzcyIsInByb21wdF9pY29uX2NsYXNzIiwiZGlzcGxheV9zZWNvbmRzIiwic2hvd19jb3VudF9kb3duIiwiZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsIm1lc3NhZ2VfY2xhc3MiLCJwcm9tcHRfY2xhc3MiLCJ3YWl0X3RpbWVyIiwiZWxlbWVudF92aXNpYmxlX3RpbWVyIiwiZWxlbWVudF90b3AiLCJpc192aXNpYmxlIiwiZGV0YWNoZWRfcG9zaXRpb24iLCJ3aW5kb3dfZWxlbWVudCIsInVwZGF0ZSIsIndhaXQiLCJ3aW5kb3ciLCJzZXRJbnRlcnZhbCIsImNvdW50X2Rvd24iLCJjbGVhckludGVydmFsIiwiY2hlY2tQb3NpdGlvbiIsImhhc0NsYXNzIiwiaXNOdWxsIiwib2Zmc2V0UGFyZW50IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwidXBkYXRlRGV0YWNoZWQiLCJwYWdlWU9mZnNldCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJwYXJzZUludCIsIm91dGVyX3Byb21wdF9jbGFzcyIsIiR3YXRjaCIsInZhbCIsIndyYXBwZXIiLCJxdWVyeVNlbGVjdG9yIiwiZW1wdHkiLCJjb21waWxlZF9tZXNzYWdlIiwiJHBhcmVudCIsImFwcGVuZCIsIm9uIiwicmVwbGFjZSIsInRlbXBsYXRlVXJsIiwiY29uc3RhbnQiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsWUFNQUEsU0FBQUMsT0FBQSw4QkNSQSxXQUVBLFlBTUEsSUFBQUMsR0FBQSxTQUFBQyxHQUtBQyxLQUFBQyxRQUFBLFdBQ0EsSUFBQUMsRUFBQUMsWUFBQUosRUFBQUUsU0FBQSxDQUVBLEdBQUFHLEdBQUFGLEVBQUFDLFlBQUFKLEVBQUFLLFNBQUEsS0FBQUwsRUFBQUssUUFDQUMsRUFBQUgsRUFBQUMsWUFBQUosRUFBQU0sT0FBQSxLQUFBTixFQUFBTSxNQUNBQyxFQUFBSixFQUFBQyxZQUFBSixFQUFBTyxLQUFBLEtBQUFQLEVBQUFPLElBQ0FDLEVBQUFMLEVBQUFDLFlBQUFKLEVBQUFRLE1BQUEsS0FBQVIsRUFBQVEsSUFFQVIsR0FBQUUsU0FBQUcsUUFBQUEsRUFBQUMsTUFBQUEsRUFBQUMsSUFBQUEsRUFBQUMsS0FBQUEsSUFFQVIsRUFBQVMsU0FJQVYsR0FBQVcsU0FBQSxVQUVBYixRQUFBQyxPQUFBLHdCQUFBQyxXQUFBLDJCQUFBQSxNQzdCQSxXQUVBLFlBTUEsSUFBQVksR0FBQSxTQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxHQWVBLE9BQ0FDLFNBQUEsS0FDQUMsT0FDQUMsSUFBQSxJQUNBZixRQUFBLElBQ0FDLE1BQUEsSUFDQUMsSUFBQSxJQUNBQyxLQUFBLElBQ0FhLG1CQUFBLG9CQUNBQyxPQUFBLElBQ0FDLG9CQUFBLHFCQUNBQyxrQkFBQSxtQkFDQUMsZ0JBQUEsa0JBQ0FDLGdCQUFBLGlCQUNBQyx5QkFBQSx5QkFDQXpCLFFBQUEsa0JBRUFILFdBQUEsbUNBQ0E2QixLQUFBLFNBQUFULEVBQUFVLEVBQUFDLEVBQUEvQixHQUVBLEdBQUFxQixHQUFBRCxFQUFBQyxPQUdBRCxHQUFBWSxjQUFBaEIsRUFDQUksRUFBQWEsYUFBQWhCLENBR0EsSUFBQWlCLEdBQ0FDLEVBQ0FDLENBQ0FoQixHQUFBaUIsWUFBQSxDQUdBLElBQUFDLEdBQ0FDLEVBQUF6QyxRQUFBZ0MsUUFBQWpCLEVBTUFRLEdBQUFYLE1BQUEsV0FDQVUsRUFBQVYsU0FHQVcsRUFBQW1CLE9BQUEsV0FDQXBCLEVBQUFvQixVQVVBcEIsRUFBQVYsTUFBQSxXQUNBVSxFQUFBaUIsWUFBQSxHQU1BakIsRUFBQXFCLEtBQUEsV0FXQVAsRUFBQVEsT0FBQUMsWUFBQSxXQUVBLE1BQUF2QixFQUFBd0IsWUFDQUYsT0FBQUcsY0FBQVgsR0FDQWQsRUFBQVYsU0FFQVUsRUFBQXFCLFFBRUEsTUFNQXJCLEVBQUEwQixjQUFBLFdBR0ExQixFQUFBaUIsYUFBQVAsRUFBQWlCLFNBQUEsYUFBQTNDLEVBQUE0QyxPQUFBbEIsRUFBQSxHQUFBbUIsY0FHQWQsRUFBQU8sT0FBQUMsWUFBQXZCLEVBQUEwQixjQUFBLE1BSUFWLEVBQUFOLEVBQUEsR0FBQW9CLHdCQUFBQyxJQUdBL0IsRUFBQWdDLG1CQU9BaEMsRUFBQWdDLGVBQUEsV0FHQVYsT0FBQUcsY0FBQVYsSUFHQUwsRUFBQWlCLFNBQUEsYUFBQSxHQUFBWCxHQUFBdkIsRUFBQXdDLFlBQUEsR0FDQWYsRUFBQXpCLEVBQUF3QyxZQUNBdkIsRUFBQXdCLFNBQUEsYUFHQXhCLEVBQUFpQixTQUFBLGNBQUEzQyxFQUFBQyxZQUFBaUMsSUFBQXpCLEVBQUF3QyxhQUFBZixHQUVBUixFQUFBeUIsWUFBQSxhQU9BbkMsRUFBQW9CLE9BQUEsV0FHQXBCLEVBQUFpQixZQUFBLEVBR0FqQixFQUFBUSwwQkFDQVIsRUFBQTBCLGdCQUlBMUIsRUFBQXdCLFdBQUF4QyxFQUFBb0QsU0FBQXBDLEVBQUFNLGlCQUdBZ0IsT0FBQUcsY0FBQVgsR0FHQTlCLEVBQUFDLFlBQUFlLEVBQUF3QixhQUFBLElBQUF4QixFQUFBd0IsYUFHQXhCLEVBQUFxQixPQUdBckIsRUFBQXFDLG1CQUFBdkMsSUFRQUUsRUFBQXNDLE9BQUEsa0JBQUEsU0FBQUMsR0FFQXZELEVBQUFDLFlBQUFzRCxJQUFBLEtBQUFBLElBQ0F2QyxFQUFBTSxnQkFBQXRCLEVBQUFvRCxTQUFBRyxHQUNBdkMsRUFBQXdCLFdBQUF4QyxFQUFBb0QsU0FBQUcsTUFJQXZDLEVBQUFzQyxPQUFBLFVBQUEsU0FBQUMsR0FDQSxHQUFBQyxHQUFBOUQsUUFBQWdDLFFBQUFBLEVBQUEsR0FBQStCLGNBQUEsbUNBR0EsSUFGQUQsRUFBQUUsUUFFQTFELEVBQUFDLFlBQUFzRCxJQUFBLEtBQUFBLEVBTUFqQixPQUFBRyxjQUFBWCxHQUNBZCxFQUFBVixZQVBBLENBQ0EsR0FBQXFELEdBQUFoRCxFQUFBLFNBQUE0QyxFQUFBLFdBQUF2QyxFQUFBNEMsUUFBQUEsUUFDQUosR0FBQUssT0FBQUYsR0FFQTNDLEVBQUFvQixZQU9BcEIsRUFBQXNDLE9BQUEsU0FBQSxTQUFBQyxHQUdBdkQsRUFBQUMsWUFBQXNELElBQUEsS0FBQUEsRUFHQXZDLEVBQUFxQyxtQkFBQSxHQUZBckMsRUFBQXFDLG1CQUFBdkMsSUFZQUUsRUFBQVEsMEJBQ0FXLEVBQUEyQixHQUFBLFNBQUEsV0FDQTlELEVBQUFDLFlBQUFlLEVBQUFkLFVBQUEsS0FBQWMsRUFBQWQsU0FHQWMsRUFBQTBCLG1CQUtBcUIsU0FBQSxFQUNBQyxZQUFBLG9DQUlBeEQsR0FBQUQsU0FDQSxVQUNBLFdBQ0EsV0FDQSwrQkFDQSxzQ0FDQSwyQ0FHQWIsUUFBQUMsT0FBQSx3QkFDQWEsVUFBQSx1QkFBQUEsTUMzUEEsV0FFQSxZQU1BZCxTQUFBQyxPQUFBLHdCQUNBc0UsU0FBQSwrQkFBQSxXQUNBQSxTQUFBLHNDQUFBLFVBQ0FBLFNBQUEsMENBQUEiLCJmaWxlIjoiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS50bXBsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJywgW10pO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZSBjb250cm9sbGVyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YXIgY29udHJvbGxlciA9IGZ1bmN0aW9uICgkcykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBvbkNsaWNrXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCgkcy5vbkNsaWNrKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAhXy5pc1VuZGVmaW5lZCgkcy5tZXNzYWdlKSA/ICRzLm1lc3NhZ2UgOiBudWxsO1xuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9ICFfLmlzVW5kZWZpbmVkKCRzLnN0YXRlKSA/ICRzLnN0YXRlIDogbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gIV8uaXNVbmRlZmluZWQoJHMua2V5KSA/ICRzLmtleSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAhXy5pc1VuZGVmaW5lZCgkcy5kYXRhKSA/ICRzLmRhdGEgOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgJHMub25DbGljayh7bWVzc2FnZTogbWVzc2FnZSwgc3RhdGU6IHN0YXRlLCBrZXk6IGtleSwgZGF0YTogZGF0YX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHMuY2xvc2UoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgY29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnXTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScpLmNvbnRyb2xsZXIoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlQ3RybCcsIGNvbnRyb2xsZXIpO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBhbmd1bGFyLWJldHRlci1tZXNzYWdlIGRpcmVjdGl2ZVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgdmFyIGRpcmVjdGl2ZSA9IGZ1bmN0aW9uKFxuICAgICAgICAkd2luZG93LFxuICAgICAgICAkdGltZW91dCxcbiAgICAgICAgJGNvbXBpbGUsXG4gICAgICAgIE1FU1NBR0VfQ0xBU1MsXG4gICAgICAgIFBST01QVF9DTEFTUyxcbiAgICAgICAgSEFTX1BST01QVF9DTEFTU1xuICAgICkge1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldFBvc2l0aW9uKGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciB4UG9zaXRpb24gPSAwO1xuICAgICAgICAgICAgdmFyIHlQb3NpdGlvbiA9IDA7XG5cbiAgICAgICAgICAgIHdoaWxlKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICB4UG9zaXRpb24gKz0gKGVsZW1lbnQub2Zmc2V0TGVmdCAtIGVsZW1lbnQuc2Nyb2xsTGVmdCArIGVsZW1lbnQuY2xpZW50TGVmdCk7XG4gICAgICAgICAgICAgICAgeVBvc2l0aW9uICs9IChlbGVtZW50Lm9mZnNldFRvcCAtIGVsZW1lbnQuc2Nyb2xsVG9wICsgZWxlbWVudC5jbGllbnRUb3ApO1xuICAgICAgICAgICAgICAgIGVsZW1lbnQgPSBlbGVtZW50Lm9mZnNldFBhcmVudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7IHg6IHhQb3NpdGlvbiwgeTogeVBvc2l0aW9uIH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgICAgIGFwaTogICAgICAgICAgICAgICAgICAgIFwiPVwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICAgICAgICAgICAgICAgIFwiPVwiLCAvLyB3aWxsIGJlIHBhc3NlZCBiYWNrIG9uIGV2ZW50c1xuICAgICAgICAgICAgICAgIHN0YXRlOiAgICAgICAgICAgICAgICAgIFwiPVwiLCAvLyB3aWxsIGJlIHBhc3NlZCBiYWNrIG9uIGV2ZW50c1xuICAgICAgICAgICAgICAgIGtleTogICAgICAgICAgICAgICAgICAgIFwiPVwiLCAvLyB3aWxsIGJlIHBhc3NlZCBiYWNrIG9uIGV2ZW50c1xuICAgICAgICAgICAgICAgIGRhdGE6ICAgICAgICAgICAgICAgICAgIFwiPVwiLCAvLyB3aWxsIGJlIHBhc3NlZCBiYWNrIG9uIGV2ZW50c1xuICAgICAgICAgICAgICAgIG1lc3NhZ2VfaWNvbl9jbGFzczogICAgIFwiPW1lc3NhZ2VJY29uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBwcm9tcHQ6ICAgICAgICAgICAgICAgICBcIj1cIixcbiAgICAgICAgICAgICAgICBwcm9tcHRfYnV0dG9uX2NsYXNzOiAgICBcIj1wcm9tcHRCdXR0b25DbGFzc1wiLFxuICAgICAgICAgICAgICAgIHByb21wdF9pY29uX2NsYXNzOiAgICAgIFwiPXByb21wdEljb25DbGFzc1wiLFxuICAgICAgICAgICAgICAgIGRpc3BsYXlfc2Vjb25kczogICAgICAgIFwiPWRpc3BsYXlTZWNvbmRzXCIsXG4gICAgICAgICAgICAgICAgc2hvd19jb3VudF9kb3duOiAgICAgICAgXCI9c2hvd0NvdW50RG93blwiLFxuICAgICAgICAgICAgICAgIGZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbDogXCI9Zml4ZWRQb3NpdGlvbk9uU2Nyb2xsXCIsXG4gICAgICAgICAgICAgICAgb25DbGljazogICAgICAgICAgICAgICAgXCImb25Qcm9tcHRDbGlja1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgY29udHJvbGxlcjogXCJBbmd1bGFyQmV0dGVyTWVzc2FnZUN0cmwgYXMgY3RybFwiLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjb250cm9sbGVyKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgYXBpID0gc2NvcGUuYXBpIHx8IHt9O1xuXG4gICAgICAgICAgICAgICAgLy8gY2xhc3Nlc1xuICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2VfY2xhc3MgPSBNRVNTQUdFX0NMQVNTO1xuICAgICAgICAgICAgICAgIHNjb3BlLnByb21wdF9jbGFzcyA9IFBST01QVF9DTEFTUztcblxuICAgICAgICAgICAgICAgIC8vIGNvbnRyb2xcbiAgICAgICAgICAgICAgICB2YXIgd2FpdF90aW1lcjtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF92aXNpYmxlX3RpbWVyO1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50X3RvcDtcbiAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBmaXggb24gc2Nyb2xsXG4gICAgICAgICAgICAgICAgdmFyIGRldGFjaGVkX3Bvc2l0aW9uO1xuICAgICAgICAgICAgICAgIHZhciB3aW5kb3dfZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBhcGlcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICBhcGkuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgYXBpLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIHV0aWxzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogY2xvc2VcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHdhaXRcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS53YWl0ID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy93YWl0X3RpbWVyID0gJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgICAgIC8vICAgIGlmICgtLXNjb3BlLmNvdW50X2Rvd24gPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgICR0aW1lb3V0LmNhbmNlbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBzY29wZS53YWl0KCk7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy99LCAxMDAwKTtcbiAgICAgICAgICAgICAgICAgICAgd2FpdF90aW1lciA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tc2NvcGUuY291bnRfZG93biA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHdhaXRfdGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndhaXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwgMTAwMCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGNoZWNrUG9zaXRpb25cbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyB2aXNpYmxlICYgaXMgbm90IGRldGFjaGVkICYgaXMgbm90IHJlYWR5XG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5pc192aXNpYmxlICYmICFlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmIF8uaXNOdWxsKGVsZW1lbnRbMF0ub2Zmc2V0UGFyZW50KSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB3YWl0XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50X3Zpc2libGVfdGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoc2NvcGUuY2hlY2tQb3NpdGlvbiwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGVsZW1lbnQgdG9wIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF90b3AgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGVEZXRhY2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHVwZGF0ZURldGFjaGVkXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlRGV0YWNoZWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwoZWxlbWVudF92aXNpYmxlX3RpbWVyKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGlzIG5vdCBkZXRhY2hlZCBhbmQgaXMgYXQgdGhlIHRvcCBvZiB2aWV3cG9ydCwgdGhlbiBkZXRhY2hcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmIGVsZW1lbnRfdG9wIDw9IDAgJiYgJHdpbmRvdy5wYWdlWU9mZnNldCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRldGFjaGVkX3Bvc2l0aW9uID0gJHdpbmRvdy5wYWdlWU9mZnNldDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2RldGFjaGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyBkZXRhY2hlZCBhbmQgaXMgYXQgb3IgYWJvdmUgZGV0YWNoZWQgcG9zaXRpb24sIHRoZW4gYXR0YWNoXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnQuaGFzQ2xhc3MoJ2RldGFjaGVkJykgJiYgIV8uaXNVbmRlZmluZWQoZGV0YWNoZWRfcG9zaXRpb24pICYmICR3aW5kb3cucGFnZVlPZmZzZXQgPD0gZGV0YWNoZWRfcG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vZGV0YWNoZWRfcG9zaXRpb24gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdkZXRhY2hlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHVwZGF0ZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZSA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCB2aXNpYmlsaXR5XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzX3Zpc2libGUgPSB0cnVlO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNoZWNrUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc2V0IGNvdW50IGRvd25cbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuY291bnRfZG93biA9IF8ucGFyc2VJbnQoc2NvcGUuZGlzcGxheV9zZWNvbmRzKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzdG9wIHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LmNsZWFySW50ZXJ2YWwod2FpdF90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYXV0byBjbG9zZSBhZnRlciBpbnRlcnZhbFxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2NvcGUuY291bnRfZG93bikgJiYgc2NvcGUuY291bnRfZG93biAhPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydCB3YWl0XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCBvdXRlciBwcm9tdCBjbGFzc1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gSEFTX1BST01QVF9DTEFTUztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gd2F0Y2hlcnNcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2Rpc3BsYXlfc2Vjb25kcycsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGlzcGxheV9zZWNvbmRzID0gXy5wYXJzZUludCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY291bnRfZG93biA9IF8ucGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdtZXNzYWdlJywgZnVuY3Rpb24odmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB3cmFwcGVyID0gYW5ndWxhci5lbGVtZW50KGVsZW1lbnRbMF0ucXVlcnlTZWxlY3RvcignLmFuZ3VsYXItYmV0dGVyLW1lc3NhZ2Utd3JhcHBlcicpKTtcbiAgICAgICAgICAgICAgICAgICAgd3JhcHBlci5lbXB0eSgpO1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbXBpbGVkX21lc3NhZ2UgPSAkY29tcGlsZSgnPHNwYW4+JyArIHZhbCArICc8L3NwYW4+Jykoc2NvcGUuJHBhcmVudC4kcGFyZW50KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdyYXBwZXIuYXBwZW5kKGNvbXBpbGVkX21lc3NhZ2UpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHdhaXRfdGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9tcHQnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgb3V0ZXIgcHJvbXQgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBIQVNfUFJPTVBUX0NMQVNTO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIGV2ZW50c1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8vIHdpbmRvdyBzY3JvbGxcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5maXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93X2VsZW1lbnQub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNjb3BlLm1lc3NhZ2UpICYmIHNjb3BlLm1lc3NhZ2UgIT09IFwiXCIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9hbmd1bGFyLWJldHRlci1tZXNzYWdlLmh0bWwnXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGRpcmVjdGl2ZS4kaW5qZWN0ID0gW1xuICAgICAgICAnJHdpbmRvdycsXG4gICAgICAgICckdGltZW91dCcsXG4gICAgICAgICckY29tcGlsZScsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0NMQVNTJyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfUFJPTVBUX0NMQVNTJyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfSEFTX1BST01QVF9DTEFTUydcbiAgICBdO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnYW5ndWxhckJldHRlck1lc3NhZ2UnLCBkaXJlY3RpdmUpO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZSBzZXR0aW5nc1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJylcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0NMQVNTJywgICAgICAgICAgICAgICBcIm1lc3NhZ2VcIilcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX1BST01QVF9DTEFTUycsICAgICAgICBcInByb21wdFwiKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfSEFTX1BST01QVF9DTEFTUycsICAgIFwiaGFzLXByb21wdFwiKTtcblxufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
