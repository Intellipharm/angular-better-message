!function(){"use strict";angular.module("AngularBetterMessage",[])}(),angular.module("AngularBetterMessage",[]).run(["$templateCache",function(s){s.put("html/angular-better-message.html",'<div class="angular-better-message" ng-class="[state, outer_prompt_class]" ng-show="is_visible"><div ng-class="message_class"><span ng-class="message_icon_class"></span> {{message}}&nbsp; <span class="countdown" ng-if="show_count_down">{{count_down}}</span></div><div ng-if="prompt" ng-class="prompt_class"><button ng-class="prompt_button_class" ng-click="ctrl.onClick()">{{prompt}}<span ng-class="prompt_icon_class"></span></button></div></div>')}]),function(){"use strict";var s=function(s){this.onClick=function(){_.isUndefined(s.onClick)||s.onClick(),s.close()}};s.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",s)}(),function(){"use strict";var s=function(s,e,n,t,a){return{restrict:"EA",scope:{state:"=state",message:"=message",message_icon_class:"=messageIconClass",prompt:"=prompt",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(o,c,i,l){o.message_class=n,o.prompt_class=t;var r,u,p;o.is_visible=!1;var d,g=angular.element(s);o.close=function(){o.is_visible=!1},o.wait=function(){r=e(function(){0===--o.count_down?(e.cancel(r),o.close()):o.wait()},1e3)},o.checkPosition=function(){p=c[0].getBoundingClientRect().top,0===p&&s.pageYOffset>0&&_.isNull(c[0].offsetParent)?u=e(o.updateDetached,1):o.updateDetached()},o.updateDetached=function(){e.cancel(u),!c.hasClass("detached")&&0>=p&&s.pageYOffset>0?(d=s.pageYOffset,c.addClass("detached")):c.hasClass("detached")&&!_.isUndefined(d)&&s.pageYOffset<=d&&c.removeClass("detached")},o.$watch("display_seconds",function(s){_.isUndefined(s)||""===s||(o.display_seconds=_.parseInt(s),o.count_down=_.parseInt(s))}),o.$watch("message",function(s){_.isUndefined(s)||""===s?(e.cancel(r),o.close()):(o.fixed_position_on_scroll&&o.checkPosition(),o.count_down=_.parseInt(o.display_seconds),e.cancel(r),o.is_visible=!0,_.isUndefined(o.count_down)||0===o.count_down||(o.wait(),o.outer_prompt_class=a))}),o.$watch("prompt",function(s){o.outer_prompt_class=_.isUndefined(s)||""===s?"":a}),o.fixed_position_on_scroll&&g.on("scroll",function(){_.isUndefined(o.message)||""===o.message||o.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};s.$inject=["$window","$timeout","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",s)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLXRlbXBsYXRlcy5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UtY29udHJvbGxlci5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UtZGlyZWN0aXZlLmpzIiwiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS1zZXR0aW5ncy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiLCJjb250cm9sbGVyIiwiJHMiLCJ0aGlzIiwib25DbGljayIsIl8iLCJpc1VuZGVmaW5lZCIsImNsb3NlIiwiJGluamVjdCIsImRpcmVjdGl2ZSIsIiR3aW5kb3ciLCIkdGltZW91dCIsIk1FU1NBR0VfQ0xBU1MiLCJQUk9NUFRfQ0xBU1MiLCJIQVNfUFJPTVBUX0NMQVNTIiwicmVzdHJpY3QiLCJzY29wZSIsInN0YXRlIiwibWVzc2FnZSIsIm1lc3NhZ2VfaWNvbl9jbGFzcyIsInByb21wdCIsInByb21wdF9idXR0b25fY2xhc3MiLCJwcm9tcHRfaWNvbl9jbGFzcyIsImRpc3BsYXlfc2Vjb25kcyIsInNob3dfY291bnRfZG93biIsImZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCIsImxpbmsiLCJlbGVtZW50IiwiYXR0cnMiLCJtZXNzYWdlX2NsYXNzIiwicHJvbXB0X2NsYXNzIiwid2FpdF90aW1lciIsImVsZW1lbnRfdmlzaWJsZV90aW1lciIsImVsZW1lbnRfdG9wIiwiaXNfdmlzaWJsZSIsImRldGFjaGVkX3Bvc2l0aW9uIiwid2luZG93X2VsZW1lbnQiLCJ3YWl0IiwiY291bnRfZG93biIsImNhbmNlbCIsImNoZWNrUG9zaXRpb24iLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJwYWdlWU9mZnNldCIsImlzTnVsbCIsIm9mZnNldFBhcmVudCIsInVwZGF0ZURldGFjaGVkIiwiaGFzQ2xhc3MiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwiJHdhdGNoIiwidmFsIiwicGFyc2VJbnQiLCJvdXRlcl9wcm9tcHRfY2xhc3MiLCJvbiIsInJlcGxhY2UiLCJ0ZW1wbGF0ZVVybCIsImNvbnN0YW50Il0sIm1hcHBpbmdzIjoiQ0FBQSxXQUVBLFlBTUFBLFNBQUFDLE9BQUEsOEJDUkFELFFBQUFDLE9BQUEsMkJBQUFDLEtBQUEsaUJBQUEsU0FBQUMsR0FBQUEsRUFBQUMsSUFBQSxtQ0FBQSxvY0NBQSxXQUVBLFlBTUEsSUFBQUMsR0FBQSxTQUFBQyxHQUtBQyxLQUFBQyxRQUFBLFdBQ0FDLEVBQUFDLFlBQUFKLEVBQUFFLFVBQ0FGLEVBQUFFLFVBRUFGLEVBQUFLLFNBSUFOLEdBQUFPLFNBQUEsVUFFQVosUUFBQUMsT0FBQSx3QkFBQUksV0FBQSwyQkFBQUEsTUN2QkEsV0FFQSxZQU1BLElBQUFRLEdBQUEsU0FDQUMsRUFDQUMsRUFDQUMsRUFDQUMsRUFDQUMsR0FlQSxPQUNBQyxTQUFBLEtBQ0FDLE9BQ0FDLE1BQUEsU0FDQUMsUUFBQSxXQUNBQyxtQkFBQSxvQkFDQUMsT0FBQSxVQUNBQyxvQkFBQSxxQkFDQUMsa0JBQUEsbUJBQ0FDLGdCQUFBLGtCQUNBQyxnQkFBQSxpQkFDQUMseUJBQUEseUJBQ0FyQixRQUFBLGtCQUVBSCxXQUFBLG1DQUNBeUIsS0FBQSxTQUFBVixFQUFBVyxFQUFBQyxFQUFBM0IsR0FHQWUsRUFBQWEsY0FBQWpCLEVBQ0FJLEVBQUFjLGFBQUFqQixDQUdBLElBQUFrQixHQUNBQyxFQUNBQyxDQUNBakIsR0FBQWtCLFlBQUEsQ0FHQSxJQUFBQyxHQUNBQyxFQUFBeEMsUUFBQStCLFFBQUFqQixFQVNBTSxHQUFBVCxNQUFBLFdBQ0FTLEVBQUFrQixZQUFBLEdBTUFsQixFQUFBcUIsS0FBQSxXQUVBTixFQUFBcEIsRUFBQSxXQUVBLE1BQUFLLEVBQUFzQixZQUNBM0IsRUFBQTRCLE9BQUFSLEdBQ0FmLEVBQUFULFNBRUFTLEVBQUFxQixRQUVBLE1BTUFyQixFQUFBd0IsY0FBQSxXQUdBUCxFQUFBTixFQUFBLEdBQUFjLHdCQUFBQyxJQUdBLElBQUFULEdBQUF2QixFQUFBaUMsWUFBQSxHQUFBdEMsRUFBQXVDLE9BQUFqQixFQUFBLEdBQUFrQixjQUdBYixFQUFBckIsRUFBQUssRUFBQThCLGVBQUEsR0FJQTlCLEVBQUE4QixrQkFPQTlCLEVBQUE4QixlQUFBLFdBR0FuQyxFQUFBNEIsT0FBQVAsSUFLQUwsRUFBQW9CLFNBQUEsYUFBQSxHQUFBZCxHQUFBdkIsRUFBQWlDLFlBQUEsR0FDQVIsRUFBQXpCLEVBQUFpQyxZQUNBaEIsRUFBQXFCLFNBQUEsYUFHQXJCLEVBQUFvQixTQUFBLGNBQUExQyxFQUFBQyxZQUFBNkIsSUFBQXpCLEVBQUFpQyxhQUFBUixHQUVBUixFQUFBc0IsWUFBQSxhQVFBakMsRUFBQWtDLE9BQUEsa0JBQUEsU0FBQUMsR0FFQTlDLEVBQUFDLFlBQUE2QyxJQUFBLEtBQUFBLElBQ0FuQyxFQUFBTyxnQkFBQWxCLEVBQUErQyxTQUFBRCxHQUNBbkMsRUFBQXNCLFdBQUFqQyxFQUFBK0MsU0FBQUQsTUFJQW5DLEVBQUFrQyxPQUFBLFVBQUEsU0FBQUMsR0FFQTlDLEVBQUFDLFlBQUE2QyxJQUFBLEtBQUFBLEdBMEJBeEMsRUFBQTRCLE9BQUFSLEdBQ0FmLEVBQUFULFVBeEJBUyxFQUFBUywwQkFDQVQsRUFBQXdCLGdCQUlBeEIsRUFBQXNCLFdBQUFqQyxFQUFBK0MsU0FBQXBDLEVBQUFPLGlCQUdBWixFQUFBNEIsT0FBQVIsR0FHQWYsRUFBQWtCLFlBQUEsRUFHQTdCLEVBQUFDLFlBQUFVLEVBQUFzQixhQUFBLElBQUF0QixFQUFBc0IsYUFHQXRCLEVBQUFxQixPQUdBckIsRUFBQXFDLG1CQUFBdkMsTUFRQUUsRUFBQWtDLE9BQUEsU0FBQSxTQUFBQyxHQU1BbkMsRUFBQXFDLG1CQUhBaEQsRUFBQUMsWUFBQTZDLElBQUEsS0FBQUEsRUFHQSxHQUZBckMsSUFZQUUsRUFBQVMsMEJBQ0FXLEVBQUFrQixHQUFBLFNBQUEsV0FDQWpELEVBQUFDLFlBQUFVLEVBQUFFLFVBQUEsS0FBQUYsRUFBQUUsU0FHQUYsRUFBQXdCLG1CQUtBZSxTQUFBLEVBQ0FDLFlBQUEsb0NBSUEvQyxHQUFBRCxTQUNBLFVBQ0EsV0FDQSwrQkFDQSxzQ0FDQSwyQ0FHQVosUUFBQUMsT0FBQSx3QkFDQVksVUFBQSx1QkFBQUEsTUNyTkEsV0FFQSxZQU1BYixTQUFBQyxPQUFBLHdCQUNBNEQsU0FBQSwrQkFBQSxXQUNBQSxTQUFBLHNDQUFBLFVBQ0FBLFNBQUEsMENBQUEiLCJmaWxlIjoiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS50bXBsLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJywgW10pO1xuXG59KSgpO1xuIiwiYW5ndWxhci5tb2R1bGUoXCJBbmd1bGFyQmV0dGVyTWVzc2FnZVwiLCBbXSkucnVuKFtcIiR0ZW1wbGF0ZUNhY2hlXCIsIGZ1bmN0aW9uKCR0ZW1wbGF0ZUNhY2hlKSB7JHRlbXBsYXRlQ2FjaGUucHV0KFwiaHRtbC9hbmd1bGFyLWJldHRlci1tZXNzYWdlLmh0bWxcIixcIjxkaXYgY2xhc3M9XFxcImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2VcXFwiIG5nLWNsYXNzPVxcXCJbc3RhdGUsIG91dGVyX3Byb21wdF9jbGFzc11cXFwiIG5nLXNob3c9XFxcImlzX3Zpc2libGVcXFwiPjxkaXYgbmctY2xhc3M9XFxcIm1lc3NhZ2VfY2xhc3NcXFwiPjxzcGFuIG5nLWNsYXNzPVxcXCJtZXNzYWdlX2ljb25fY2xhc3NcXFwiPjwvc3Bhbj4ge3ttZXNzYWdlfX0mbmJzcDsgPHNwYW4gY2xhc3M9XFxcImNvdW50ZG93blxcXCIgbmctaWY9XFxcInNob3dfY291bnRfZG93blxcXCI+e3tjb3VudF9kb3dufX08L3NwYW4+PC9kaXY+PGRpdiBuZy1pZj1cXFwicHJvbXB0XFxcIiBuZy1jbGFzcz1cXFwicHJvbXB0X2NsYXNzXFxcIj48YnV0dG9uIG5nLWNsYXNzPVxcXCJwcm9tcHRfYnV0dG9uX2NsYXNzXFxcIiBuZy1jbGljaz1cXFwiY3RybC5vbkNsaWNrKClcXFwiPnt7cHJvbXB0fX08c3BhbiBuZy1jbGFzcz1cXFwicHJvbXB0X2ljb25fY2xhc3NcXFwiPjwvc3Bhbj48L2J1dHRvbj48L2Rpdj48L2Rpdj5cIik7fV0pOyIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2UgY29udHJvbGxlclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogb25DbGlja1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoJHMub25DbGljaykpIHtcbiAgICAgICAgICAgICAgICAkcy5vbkNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZSddO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJykuY29udHJvbGxlcignQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsJywgY29udHJvbGxlcik7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIGFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UgZGlyZWN0aXZlXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YXIgZGlyZWN0aXZlID0gZnVuY3Rpb24oXG4gICAgICAgICR3aW5kb3csXG4gICAgICAgICR0aW1lb3V0LFxuICAgICAgICBNRVNTQUdFX0NMQVNTLFxuICAgICAgICBQUk9NUFRfQ0xBU1MsXG4gICAgICAgIEhBU19QUk9NUFRfQ0xBU1NcbiAgICApIHtcblxuICAgICAgICBmdW5jdGlvbiBnZXRQb3NpdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgeFBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIHZhciB5UG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICB3aGlsZShlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgeFBvc2l0aW9uICs9IChlbGVtZW50Lm9mZnNldExlZnQgLSBlbGVtZW50LnNjcm9sbExlZnQgKyBlbGVtZW50LmNsaWVudExlZnQpO1xuICAgICAgICAgICAgICAgIHlQb3NpdGlvbiArPSAoZWxlbWVudC5vZmZzZXRUb3AgLSBlbGVtZW50LnNjcm9sbFRvcCArIGVsZW1lbnQuY2xpZW50VG9wKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geyB4OiB4UG9zaXRpb24sIHk6IHlQb3NpdGlvbiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBzdGF0ZTogICAgICAgICAgICAgICAgICBcIj1zdGF0ZVwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICAgICAgICAgICAgICAgIFwiPW1lc3NhZ2VcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlX2ljb25fY2xhc3M6ICAgICBcIj1tZXNzYWdlSWNvbkNsYXNzXCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAgICAgICAgICAgICAgICAgXCI9cHJvbXB0XCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0X2J1dHRvbl9jbGFzczogICAgXCI9cHJvbXB0QnV0dG9uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBwcm9tcHRfaWNvbl9jbGFzczogICAgICBcIj1wcm9tcHRJY29uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5X3NlY29uZHM6ICAgICAgICBcIj1kaXNwbGF5U2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIHNob3dfY291bnRfZG93bjogICAgICAgIFwiPXNob3dDb3VudERvd25cIixcbiAgICAgICAgICAgICAgICBmaXhlZF9wb3NpdGlvbl9vbl9zY3JvbGw6IFwiPWZpeGVkUG9zaXRpb25PblNjcm9sbFwiLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICAgICAgICAgICAgICAgIFwiJm9uUHJvbXB0Q2xpY2tcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsIGFzIGN0cmxcIixcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY29udHJvbGxlcikge1xuXG4gICAgICAgICAgICAgICAgLy8gY2xhc3Nlc1xuICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2VfY2xhc3MgPSBNRVNTQUdFX0NMQVNTO1xuICAgICAgICAgICAgICAgIHNjb3BlLnByb21wdF9jbGFzcyA9IFBST01QVF9DTEFTUztcblxuICAgICAgICAgICAgICAgIC8vIGNvbnRyb2xcbiAgICAgICAgICAgICAgICB2YXIgd2FpdF90aW1lcjtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF92aXNpYmxlX3RpbWVyO1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50X3RvcDtcbiAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBmaXggb24gc2Nyb2xsXG4gICAgICAgICAgICAgICAgdmFyIGRldGFjaGVkX3Bvc2l0aW9uO1xuICAgICAgICAgICAgICAgIHZhciB3aW5kb3dfZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyB1dGlsc1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGNsb3NlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB3YWl0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUud2FpdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZXIgPSAkdGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tc2NvcGUuY291bnRfZG93biA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBjaGVja1Bvc2l0aW9uXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdldCBlbGVtZW50IHRvcCBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudF90b3AgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBlbGVtZW50IGlzIG5vdCB2aXNpYmxlIHlldCAod2UgY2FuJ3QgY2FsY3VsYXRlIGl0J3MgcG9zaXRpb24pXG4gICAgICAgICAgICAgICAgICAgIGlmIChlbGVtZW50X3RvcCA9PT0gMCAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0ID4gMCAmJiBfLmlzTnVsbChlbGVtZW50WzBdLm9mZnNldFBhcmVudCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlIGFmdGVyIHRpbWVvdXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdmlzaWJsZV90aW1lciA9ICR0aW1lb3V0KHNjb3BlLnVwZGF0ZURldGFjaGVkLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGVEZXRhY2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHVwZGF0ZURldGFjaGVkXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlRGV0YWNoZWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGVsZW1lbnRfdmlzaWJsZV90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyBub3QgZGV0YWNoZWQgYW5kIGlzIGF0IHRoZSB0b3Agb2Ygdmlld3BvcnQsIHRoZW4gZGV0YWNoXG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE86IGluY2FzZSBjdXJyZW50IGRvZXMgbm90IHdvcmtcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKCFlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmIF8ucGFyc2VJbnQoZ2V0UG9zaXRpb24oZWxlbWVudFswXSkueSkgPD0gMCAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuaGFzQ2xhc3MoJ2RldGFjaGVkJykgJiYgZWxlbWVudF90b3AgPD0gMCAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWNoZWRfcG9zaXRpb24gPSAkd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZGV0YWNoZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGlzIGRldGFjaGVkIGFuZCBpcyBhdCBvciBhYm92ZSBkZXRhY2hlZCBwb3NpdGlvbiwgdGhlbiBhdHRhY2hcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiAhXy5pc1VuZGVmaW5lZChkZXRhY2hlZF9wb3NpdGlvbikgJiYgJHdpbmRvdy5wYWdlWU9mZnNldCA8PSBkZXRhY2hlZF9wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9kZXRhY2hlZF9wb3NpdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2RldGFjaGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIHdhdGNoZXJzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkaXNwbGF5X3NlY29uZHMnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRpc3BsYXlfc2Vjb25kcyA9IF8ucGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50X2Rvd24gPSBfLnBhcnNlSW50KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnbWVzc2FnZScsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNoZWNrUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgZG93blxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY291bnRfZG93biA9IF8ucGFyc2VJbnQoc2NvcGUuZGlzcGxheV9zZWNvbmRzKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RvcCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwod2FpdF90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB2aXNpYmlsaXR5XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXV0byBjbG9zZSBhZnRlciBpbnRlcnZhbFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNjb3BlLmNvdW50X2Rvd24pICYmIHNjb3BlLmNvdW50X2Rvd24gIT09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IHdhaXRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgb3V0ZXIgcHJvbXQgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBIQVNfUFJPTVBUX0NMQVNTO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHdhaXRfdGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9tcHQnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgb3V0ZXIgcHJvbXQgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBIQVNfUFJPTVBUX0NMQVNTO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIGV2ZW50c1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8vIHdpbmRvdyBzY3JvbGxcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5maXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93X2VsZW1lbnQub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNjb3BlLm1lc3NhZ2UpICYmIHNjb3BlLm1lc3NhZ2UgIT09IFwiXCIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9hbmd1bGFyLWJldHRlci1tZXNzYWdlLmh0bWwnXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGRpcmVjdGl2ZS4kaW5qZWN0ID0gW1xuICAgICAgICAnJHdpbmRvdycsXG4gICAgICAgICckdGltZW91dCcsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0NMQVNTJyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfUFJPTVBUX0NMQVNTJyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfSEFTX1BST01QVF9DTEFTUydcbiAgICBdO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnYW5ndWxhckJldHRlck1lc3NhZ2UnLCBkaXJlY3RpdmUpO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZSBzZXR0aW5nc1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJylcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0NMQVNTJywgICAgICAgICAgICAgICBcIm1lc3NhZ2VcIilcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX1BST01QVF9DTEFTUycsICAgICAgICBcInByb21wdFwiKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfSEFTX1BST01QVF9DTEFTUycsICAgIFwiaGFzLXByb21wdFwiKTtcblxufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==