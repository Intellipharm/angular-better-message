!function(){"use strict";angular.module("AngularBetterMessage",[])}(),angular.module("AngularBetterMessage",[]).run(["$templateCache",function(s){s.put("html/angular-better-message.html",'<div class="angular-better-message" ng-class="[state, outer_prompt_class]" ng-show="is_visible"><div ng-class="message_class"><span ng-class="message_icon_class"></span> {{message}}&nbsp; <span class="countdown" ng-if="show_count_down">{{count_down}}</span></div><div ng-if="prompt" ng-class="prompt_class"><button ng-class="prompt_button_class" ng-click="ctrl.onClick()">{{prompt}}<span ng-class="prompt_icon_class"></span></button></div></div>')}]),function(){"use strict";var s=function(s){this.onClick=function(){if(!_.isUndefined(s.onClick)){var e=_.isUndefined(s.message)?null:s.message,n=_.isUndefined(s.state)?null:s.state,t=_.isUndefined(s.key)?null:s.key,a=_.isUndefined(s.data)?null:s.data;s.onClick({message:e,state:n,key:t,data:a})}s.close()}};s.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",s)}(),function(){"use strict";var s=function(s,e,n,t,a){return{restrict:"EA",scope:{api:"=",message:"=",state:"=",key:"=",data:"=",message_icon_class:"=messageIconClass",prompt:"=",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(o,c,i,l){var r=o.api||{};o.message_class=n,o.prompt_class=t;var d,u,p;o.is_visible=!1;var g,m=angular.element(s);r.close=function(){o.close()},r.update=function(){o.update()},o.close=function(){o.is_visible=!1},o.wait=function(){d=e(function(){0===--o.count_down?(e.cancel(d),o.close()):o.wait()},1e3)},o.checkPosition=function(){o.is_visible&&!c.hasClass("detached")&&_.isNull(c[0].offsetParent)?u=e(o.checkPosition,100):(p=c[0].getBoundingClientRect().top,o.updateDetached())},o.updateDetached=function(){e.cancel(u),!c.hasClass("detached")&&0>=p&&s.pageYOffset>0?(g=s.pageYOffset,c.addClass("detached")):c.hasClass("detached")&&!_.isUndefined(g)&&s.pageYOffset<=g&&c.removeClass("detached")},o.update=function(){o.is_visible=!0,o.fixed_position_on_scroll&&o.checkPosition(),o.count_down=_.parseInt(o.display_seconds),e.cancel(d),_.isUndefined(o.count_down)||0===o.count_down||(o.wait(),o.outer_prompt_class=a)},o.$watch("display_seconds",function(s){_.isUndefined(s)||""===s||(o.display_seconds=_.parseInt(s),o.count_down=_.parseInt(s))}),o.$watch("message",function(s){_.isUndefined(s)||""===s?(e.cancel(d),o.close()):o.update()}),o.$watch("prompt",function(s){_.isUndefined(s)||""===s?o.outer_prompt_class="":o.outer_prompt_class=a}),o.fixed_position_on_scroll&&m.on("scroll",function(){_.isUndefined(o.message)||""===o.message||o.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};s.$inject=["$window","$timeout","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",s)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLXRlbXBsYXRlcy5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UtY29udHJvbGxlci5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UtZGlyZWN0aXZlLmpzIiwiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS1zZXR0aW5ncy5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwicnVuIiwiJHRlbXBsYXRlQ2FjaGUiLCJwdXQiLCJjb250cm9sbGVyIiwiJHMiLCJ0aGlzIiwib25DbGljayIsIl8iLCJpc1VuZGVmaW5lZCIsIm1lc3NhZ2UiLCJzdGF0ZSIsImtleSIsImRhdGEiLCJjbG9zZSIsIiRpbmplY3QiLCJkaXJlY3RpdmUiLCIkd2luZG93IiwiJHRpbWVvdXQiLCJNRVNTQUdFX0NMQVNTIiwiUFJPTVBUX0NMQVNTIiwiSEFTX1BST01QVF9DTEFTUyIsInJlc3RyaWN0Iiwic2NvcGUiLCJhcGkiLCJtZXNzYWdlX2ljb25fY2xhc3MiLCJwcm9tcHQiLCJwcm9tcHRfYnV0dG9uX2NsYXNzIiwicHJvbXB0X2ljb25fY2xhc3MiLCJkaXNwbGF5X3NlY29uZHMiLCJzaG93X2NvdW50X2Rvd24iLCJmaXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwiLCJsaW5rIiwiZWxlbWVudCIsImF0dHJzIiwibWVzc2FnZV9jbGFzcyIsInByb21wdF9jbGFzcyIsIndhaXRfdGltZXIiLCJlbGVtZW50X3Zpc2libGVfdGltZXIiLCJlbGVtZW50X3RvcCIsImlzX3Zpc2libGUiLCJkZXRhY2hlZF9wb3NpdGlvbiIsIndpbmRvd19lbGVtZW50IiwidXBkYXRlIiwid2FpdCIsImNvdW50X2Rvd24iLCJjYW5jZWwiLCJjaGVja1Bvc2l0aW9uIiwiaGFzQ2xhc3MiLCJpc051bGwiLCJvZmZzZXRQYXJlbnQiLCJnZXRCb3VuZGluZ0NsaWVudFJlY3QiLCJ0b3AiLCJ1cGRhdGVEZXRhY2hlZCIsInBhZ2VZT2Zmc2V0IiwiYWRkQ2xhc3MiLCJyZW1vdmVDbGFzcyIsInBhcnNlSW50Iiwib3V0ZXJfcHJvbXB0X2NsYXNzIiwiJHdhdGNoIiwidmFsIiwib24iLCJyZXBsYWNlIiwidGVtcGxhdGVVcmwiLCJjb25zdGFudCJdLCJtYXBwaW5ncyI6IkNBQUEsV0FFQSxZQU1BQSxTQUFBQyxPQUFBLDhCQ1JBRCxRQUFBQyxPQUFBLDJCQUFBQyxLQUFBLGlCQUFBLFNBQUFDLEdBQUFBLEVBQUFDLElBQUEsbUNBQUEsb2NDQUEsV0FFQSxZQU1BLElBQUFDLEdBQUEsU0FBQUMsR0FLQUMsS0FBQUMsUUFBQSxXQUNBLElBQUFDLEVBQUFDLFlBQUFKLEVBQUFFLFNBQUEsQ0FFQSxHQUFBRyxHQUFBRixFQUFBQyxZQUFBSixFQUFBSyxTQUFBLEtBQUFMLEVBQUFLLFFBQ0FDLEVBQUFILEVBQUFDLFlBQUFKLEVBQUFNLE9BQUEsS0FBQU4sRUFBQU0sTUFDQUMsRUFBQUosRUFBQUMsWUFBQUosRUFBQU8sS0FBQSxLQUFBUCxFQUFBTyxJQUNBQyxFQUFBTCxFQUFBQyxZQUFBSixFQUFBUSxNQUFBLEtBQUFSLEVBQUFRLElBRUFSLEdBQUFFLFNBQUFHLFFBQUFBLEVBQUFDLE1BQUFBLEVBQUFDLElBQUFBLEVBQUFDLEtBQUFBLElBRUFSLEVBQUFTLFNBSUFWLEdBQUFXLFNBQUEsVUFFQWhCLFFBQUFDLE9BQUEsd0JBQUFJLFdBQUEsMkJBQUFBLE1DN0JBLFdBRUEsWUFNQSxJQUFBWSxHQUFBLFNBQ0FDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEVBQ0FDLEdBZUEsT0FDQUMsU0FBQSxLQUNBQyxPQUNBQyxJQUFBLElBQ0FkLFFBQUEsSUFDQUMsTUFBQSxJQUNBQyxJQUFBLElBQ0FDLEtBQUEsSUFDQVksbUJBQUEsb0JBQ0FDLE9BQUEsSUFDQUMsb0JBQUEscUJBQ0FDLGtCQUFBLG1CQUNBQyxnQkFBQSxrQkFDQUMsZ0JBQUEsaUJBQ0FDLHlCQUFBLHlCQUNBeEIsUUFBQSxrQkFFQUgsV0FBQSxtQ0FDQTRCLEtBQUEsU0FBQVQsRUFBQVUsRUFBQUMsRUFBQTlCLEdBRUEsR0FBQW9CLEdBQUFELEVBQUFDLE9BR0FELEdBQUFZLGNBQUFoQixFQUNBSSxFQUFBYSxhQUFBaEIsQ0FHQSxJQUFBaUIsR0FDQUMsRUFDQUMsQ0FDQWhCLEdBQUFpQixZQUFBLENBR0EsSUFBQUMsR0FDQUMsRUFBQTNDLFFBQUFrQyxRQUFBaEIsRUFNQU8sR0FBQVYsTUFBQSxXQUNBUyxFQUFBVCxTQUdBVSxFQUFBbUIsT0FBQSxXQUNBcEIsRUFBQW9CLFVBVUFwQixFQUFBVCxNQUFBLFdBQ0FTLEVBQUFpQixZQUFBLEdBTUFqQixFQUFBcUIsS0FBQSxXQUVBUCxFQUFBbkIsRUFBQSxXQUVBLE1BQUFLLEVBQUFzQixZQUNBM0IsRUFBQTRCLE9BQUFULEdBQ0FkLEVBQUFULFNBRUFTLEVBQUFxQixRQUVBLE1BTUFyQixFQUFBd0IsY0FBQSxXQUdBeEIsRUFBQWlCLGFBQUFQLEVBQUFlLFNBQUEsYUFBQXhDLEVBQUF5QyxPQUFBaEIsRUFBQSxHQUFBaUIsY0FHQVosRUFBQXBCLEVBQUFLLEVBQUF3QixjQUFBLE1BSUFSLEVBQUFOLEVBQUEsR0FBQWtCLHdCQUFBQyxJQUdBN0IsRUFBQThCLG1CQU9BOUIsRUFBQThCLGVBQUEsV0FHQW5DLEVBQUE0QixPQUFBUixJQUdBTCxFQUFBZSxTQUFBLGFBQUEsR0FBQVQsR0FBQXRCLEVBQUFxQyxZQUFBLEdBQ0FiLEVBQUF4QixFQUFBcUMsWUFDQXJCLEVBQUFzQixTQUFBLGFBR0F0QixFQUFBZSxTQUFBLGNBQUF4QyxFQUFBQyxZQUFBZ0MsSUFBQXhCLEVBQUFxQyxhQUFBYixHQUVBUixFQUFBdUIsWUFBQSxhQU9BakMsRUFBQW9CLE9BQUEsV0FHQXBCLEVBQUFpQixZQUFBLEVBR0FqQixFQUFBUSwwQkFDQVIsRUFBQXdCLGdCQUlBeEIsRUFBQXNCLFdBQUFyQyxFQUFBaUQsU0FBQWxDLEVBQUFNLGlCQUdBWCxFQUFBNEIsT0FBQVQsR0FHQTdCLEVBQUFDLFlBQUFjLEVBQUFzQixhQUFBLElBQUF0QixFQUFBc0IsYUFHQXRCLEVBQUFxQixPQUdBckIsRUFBQW1DLG1CQUFBckMsSUFRQUUsRUFBQW9DLE9BQUEsa0JBQUEsU0FBQUMsR0FFQXBELEVBQUFDLFlBQUFtRCxJQUFBLEtBQUFBLElBQ0FyQyxFQUFBTSxnQkFBQXJCLEVBQUFpRCxTQUFBRyxHQUNBckMsRUFBQXNCLFdBQUFyQyxFQUFBaUQsU0FBQUcsTUFJQXJDLEVBQUFvQyxPQUFBLFVBQUEsU0FBQUMsR0FFQXBELEVBQUFDLFlBQUFtRCxJQUFBLEtBQUFBLEdBR0ExQyxFQUFBNEIsT0FBQVQsR0FDQWQsRUFBQVQsU0FIQVMsRUFBQW9CLFdBT0FwQixFQUFBb0MsT0FBQSxTQUFBLFNBQUFDLEdBR0FwRCxFQUFBQyxZQUFBbUQsSUFBQSxLQUFBQSxFQUdBckMsRUFBQW1DLG1CQUFBLEdBRkFuQyxFQUFBbUMsbUJBQUFyQyxJQVlBRSxFQUFBUSwwQkFDQVcsRUFBQW1CLEdBQUEsU0FBQSxXQUNBckQsRUFBQUMsWUFBQWMsRUFBQWIsVUFBQSxLQUFBYSxFQUFBYixTQUdBYSxFQUFBd0IsbUJBS0FlLFNBQUEsRUFDQUMsWUFBQSxvQ0FJQS9DLEdBQUFELFNBQ0EsVUFDQSxXQUNBLCtCQUNBLHNDQUNBLDJDQUdBaEIsUUFBQUMsT0FBQSx3QkFDQWdCLFVBQUEsdUJBQUFBLE1DM09BLFdBRUEsWUFNQWpCLFNBQUFDLE9BQUEsd0JBQ0FnRSxTQUFBLCtCQUFBLFdBQ0FBLFNBQUEsc0NBQUEsVUFDQUEsU0FBQSwwQ0FBQSIsImZpbGUiOiJhbmd1bGFyLWJldHRlci1tZXNzYWdlLnRtcGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBBbmd1bGFyIEJldHRlciBNZXNzYWdlXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnLCBbXSk7XG5cbn0pKCk7XG4iLCJhbmd1bGFyLm1vZHVsZShcIkFuZ3VsYXJCZXR0ZXJNZXNzYWdlXCIsIFtdKS5ydW4oW1wiJHRlbXBsYXRlQ2FjaGVcIiwgZnVuY3Rpb24oJHRlbXBsYXRlQ2FjaGUpIHskdGVtcGxhdGVDYWNoZS5wdXQoXCJodG1sL2FuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuaHRtbFwiLFwiPGRpdiBjbGFzcz1cXFwiYW5ndWxhci1iZXR0ZXItbWVzc2FnZVxcXCIgbmctY2xhc3M9XFxcIltzdGF0ZSwgb3V0ZXJfcHJvbXB0X2NsYXNzXVxcXCIgbmctc2hvdz1cXFwiaXNfdmlzaWJsZVxcXCI+PGRpdiBuZy1jbGFzcz1cXFwibWVzc2FnZV9jbGFzc1xcXCI+PHNwYW4gbmctY2xhc3M9XFxcIm1lc3NhZ2VfaWNvbl9jbGFzc1xcXCI+PC9zcGFuPiB7e21lc3NhZ2V9fSZuYnNwOyA8c3BhbiBjbGFzcz1cXFwiY291bnRkb3duXFxcIiBuZy1pZj1cXFwic2hvd19jb3VudF9kb3duXFxcIj57e2NvdW50X2Rvd259fTwvc3Bhbj48L2Rpdj48ZGl2IG5nLWlmPVxcXCJwcm9tcHRcXFwiIG5nLWNsYXNzPVxcXCJwcm9tcHRfY2xhc3NcXFwiPjxidXR0b24gbmctY2xhc3M9XFxcInByb21wdF9idXR0b25fY2xhc3NcXFwiIG5nLWNsaWNrPVxcXCJjdHJsLm9uQ2xpY2soKVxcXCI+e3twcm9tcHR9fTxzcGFuIG5nLWNsYXNzPVxcXCJwcm9tcHRfaWNvbl9jbGFzc1xcXCI+PC9zcGFuPjwvYnV0dG9uPjwvZGl2PjwvZGl2PlwiKTt9XSk7IiwiKGZ1bmN0aW9uICgpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZSBjb250cm9sbGVyXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YXIgY29udHJvbGxlciA9IGZ1bmN0aW9uICgkcykge1xuXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBvbkNsaWNrXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm9uQ2xpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCgkcy5vbkNsaWNrKSkge1xuXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAhXy5pc1VuZGVmaW5lZCgkcy5tZXNzYWdlKSA/ICRzLm1lc3NhZ2UgOiBudWxsO1xuICAgICAgICAgICAgICAgIHZhciBzdGF0ZSA9ICFfLmlzVW5kZWZpbmVkKCRzLnN0YXRlKSA/ICRzLnN0YXRlIDogbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIga2V5ID0gIV8uaXNVbmRlZmluZWQoJHMua2V5KSA/ICRzLmtleSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSAhXy5pc1VuZGVmaW5lZCgkcy5kYXRhKSA/ICRzLmRhdGEgOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgJHMub25DbGljayh7bWVzc2FnZTogbWVzc2FnZSwgc3RhdGU6IHN0YXRlLCBrZXk6IGtleSwgZGF0YTogZGF0YX0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHMuY2xvc2UoKTtcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgY29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnXTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScpLmNvbnRyb2xsZXIoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlQ3RybCcsIGNvbnRyb2xsZXIpO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBhbmd1bGFyLWJldHRlci1tZXNzYWdlIGRpcmVjdGl2ZVxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgdmFyIGRpcmVjdGl2ZSA9IGZ1bmN0aW9uKFxuICAgICAgICAkd2luZG93LFxuICAgICAgICAkdGltZW91dCxcbiAgICAgICAgTUVTU0FHRV9DTEFTUyxcbiAgICAgICAgUFJPTVBUX0NMQVNTLFxuICAgICAgICBIQVNfUFJPTVBUX0NMQVNTXG4gICAgKSB7XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UG9zaXRpb24oZWxlbWVudCkge1xuICAgICAgICAgICAgdmFyIHhQb3NpdGlvbiA9IDA7XG4gICAgICAgICAgICB2YXIgeVBvc2l0aW9uID0gMDtcblxuICAgICAgICAgICAgd2hpbGUoZWxlbWVudCkge1xuICAgICAgICAgICAgICAgIHhQb3NpdGlvbiArPSAoZWxlbWVudC5vZmZzZXRMZWZ0IC0gZWxlbWVudC5zY3JvbGxMZWZ0ICsgZWxlbWVudC5jbGllbnRMZWZ0KTtcbiAgICAgICAgICAgICAgICB5UG9zaXRpb24gKz0gKGVsZW1lbnQub2Zmc2V0VG9wIC0gZWxlbWVudC5zY3JvbGxUb3AgKyBlbGVtZW50LmNsaWVudFRvcCk7XG4gICAgICAgICAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQub2Zmc2V0UGFyZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHsgeDogeFBvc2l0aW9uLCB5OiB5UG9zaXRpb24gfTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICAgICAgYXBpOiAgICAgICAgICAgICAgICAgICAgXCI9XCIsXG4gICAgICAgICAgICAgICAgbWVzc2FnZTogICAgICAgICAgICAgICAgXCI9XCIsIC8vIHdpbGwgYmUgcGFzc2VkIGJhY2sgb24gZXZlbnRzXG4gICAgICAgICAgICAgICAgc3RhdGU6ICAgICAgICAgICAgICAgICAgXCI9XCIsIC8vIHdpbGwgYmUgcGFzc2VkIGJhY2sgb24gZXZlbnRzXG4gICAgICAgICAgICAgICAga2V5OiAgICAgICAgICAgICAgICAgICAgXCI9XCIsIC8vIHdpbGwgYmUgcGFzc2VkIGJhY2sgb24gZXZlbnRzXG4gICAgICAgICAgICAgICAgZGF0YTogICAgICAgICAgICAgICAgICAgXCI9XCIsIC8vIHdpbGwgYmUgcGFzc2VkIGJhY2sgb24gZXZlbnRzXG4gICAgICAgICAgICAgICAgbWVzc2FnZV9pY29uX2NsYXNzOiAgICAgXCI9bWVzc2FnZUljb25DbGFzc1wiLFxuICAgICAgICAgICAgICAgIHByb21wdDogICAgICAgICAgICAgICAgIFwiPVwiLFxuICAgICAgICAgICAgICAgIHByb21wdF9idXR0b25fY2xhc3M6ICAgIFwiPXByb21wdEJ1dHRvbkNsYXNzXCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0X2ljb25fY2xhc3M6ICAgICAgXCI9cHJvbXB0SWNvbkNsYXNzXCIsXG4gICAgICAgICAgICAgICAgZGlzcGxheV9zZWNvbmRzOiAgICAgICAgXCI9ZGlzcGxheVNlY29uZHNcIixcbiAgICAgICAgICAgICAgICBzaG93X2NvdW50X2Rvd246ICAgICAgICBcIj1zaG93Q291bnREb3duXCIsXG4gICAgICAgICAgICAgICAgZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsOiBcIj1maXhlZFBvc2l0aW9uT25TY3JvbGxcIixcbiAgICAgICAgICAgICAgICBvbkNsaWNrOiAgICAgICAgICAgICAgICBcIiZvblByb21wdENsaWNrXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250cm9sbGVyOiBcIkFuZ3VsYXJCZXR0ZXJNZXNzYWdlQ3RybCBhcyBjdHJsXCIsXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIGNvbnRyb2xsZXIpIHtcblxuICAgICAgICAgICAgICAgIHZhciBhcGkgPSBzY29wZS5hcGkgfHwge307XG5cbiAgICAgICAgICAgICAgICAvLyBjbGFzc2VzXG4gICAgICAgICAgICAgICAgc2NvcGUubWVzc2FnZV9jbGFzcyA9IE1FU1NBR0VfQ0xBU1M7XG4gICAgICAgICAgICAgICAgc2NvcGUucHJvbXB0X2NsYXNzID0gUFJPTVBUX0NMQVNTO1xuXG4gICAgICAgICAgICAgICAgLy8gY29udHJvbFxuICAgICAgICAgICAgICAgIHZhciB3YWl0X3RpbWVyO1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50X3Zpc2libGVfdGltZXI7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRfdG9wO1xuICAgICAgICAgICAgICAgIHNjb3BlLmlzX3Zpc2libGUgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIC8vIGZpeCBvbiBzY3JvbGxcbiAgICAgICAgICAgICAgICB2YXIgZGV0YWNoZWRfcG9zaXRpb247XG4gICAgICAgICAgICAgICAgdmFyIHdpbmRvd19lbGVtZW50ID0gYW5ndWxhci5lbGVtZW50KCR3aW5kb3cpO1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIGFwaVxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIGFwaS5jbG9zZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBhcGkudXBkYXRlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gdXRpbHNcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBjbG9zZVxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmlzX3Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogd2FpdFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLndhaXQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICB3YWl0X3RpbWVyID0gJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtLXNjb3BlLmNvdW50X2Rvd24gPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwod2FpdF90aW1lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2FpdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogY2hlY2tQb3NpdGlvblxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLmNoZWNrUG9zaXRpb24gPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGlzIHZpc2libGUgJiBpcyBub3QgZGV0YWNoZWQgJiBpcyBub3QgcmVhZHlcbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmlzX3Zpc2libGUgJiYgIWVsZW1lbnQuaGFzQ2xhc3MoJ2RldGFjaGVkJykgJiYgXy5pc051bGwoZWxlbWVudFswXS5vZmZzZXRQYXJlbnQpKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHdhaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdmlzaWJsZV90aW1lciA9ICR0aW1lb3V0KHNjb3BlLmNoZWNrUG9zaXRpb24sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCBlbGVtZW50IHRvcCBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdG9wID0gZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlRGV0YWNoZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB1cGRhdGVEZXRhY2hlZFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZURldGFjaGVkID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIHRpbWVyXG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbChlbGVtZW50X3Zpc2libGVfdGltZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgbm90IGRldGFjaGVkIGFuZCBpcyBhdCB0aGUgdG9wIG9mIHZpZXdwb3J0LCB0aGVuIGRldGFjaFxuICAgICAgICAgICAgICAgICAgICBpZiAoIWVsZW1lbnQuaGFzQ2xhc3MoJ2RldGFjaGVkJykgJiYgZWxlbWVudF90b3AgPD0gMCAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0ID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGV0YWNoZWRfcG9zaXRpb24gPSAkd2luZG93LnBhZ2VZT2Zmc2V0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5hZGRDbGFzcygnZGV0YWNoZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvLyBlbGVtZW50IGlzIGRldGFjaGVkIGFuZCBpcyBhdCBvciBhYm92ZSBkZXRhY2hlZCBwb3NpdGlvbiwgdGhlbiBhdHRhY2hcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiAhXy5pc1VuZGVmaW5lZChkZXRhY2hlZF9wb3NpdGlvbikgJiYgJHdpbmRvdy5wYWdlWU9mZnNldCA8PSBkZXRhY2hlZF9wb3NpdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9kZXRhY2hlZF9wb3NpdGlvbiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2RldGFjaGVkJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICogdXBkYXRlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHZpc2liaWxpdHlcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IHRydWU7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzZXQgY291bnQgZG93blxuICAgICAgICAgICAgICAgICAgICBzY29wZS5jb3VudF9kb3duID0gXy5wYXJzZUludChzY29wZS5kaXNwbGF5X3NlY29uZHMpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHN0b3AgdGltZW91dFxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwod2FpdF90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gYXV0byBjbG9zZSBhZnRlciBpbnRlcnZhbFxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2NvcGUuY291bnRfZG93bikgJiYgc2NvcGUuY291bnRfZG93biAhPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzdGFydCB3YWl0XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCBvdXRlciBwcm9tdCBjbGFzc1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gSEFTX1BST01QVF9DTEFTUztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gd2F0Y2hlcnNcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2Rpc3BsYXlfc2Vjb25kcycsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGlzcGxheV9zZWNvbmRzID0gXy5wYXJzZUludCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY291bnRfZG93biA9IF8ucGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdtZXNzYWdlJywgZnVuY3Rpb24odmFsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvbXB0JywgZnVuY3Rpb24odmFsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IG91dGVyIHByb210IGNsYXNzXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gSEFTX1BST01QVF9DTEFTUztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBldmVudHNcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICAvLyB3aW5kb3cgc2Nyb2xsXG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvd19lbGVtZW50Lm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzY29wZS5tZXNzYWdlKSAmJiBzY29wZS5tZXNzYWdlICE9PSBcIlwiKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNoZWNrUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvYW5ndWxhci1iZXR0ZXItbWVzc2FnZS5odG1sJ1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBkaXJlY3RpdmUuJGluamVjdCA9IFtcbiAgICAgICAgJyR3aW5kb3cnLFxuICAgICAgICAnJHRpbWVvdXQnLFxuICAgICAgICAnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9DTEFTUycsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX1BST01QVF9DTEFTUycsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0hBU19QUk9NUFRfQ0xBU1MnXG4gICAgXTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2FuZ3VsYXJCZXR0ZXJNZXNzYWdlJywgZGlyZWN0aXZlKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2Ugc2V0dGluZ3NcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScpXG4gICAgICAgIC5jb25zdGFudCgnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9DTEFTUycsICAgICAgICAgICAgICAgXCJtZXNzYWdlXCIpXG4gICAgICAgIC5jb25zdGFudCgnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9QUk9NUFRfQ0xBU1MnLCAgICAgICAgXCJwcm9tcHRcIilcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0hBU19QUk9NUFRfQ0xBU1MnLCAgICBcImhhcy1wcm9tcHRcIik7XG5cbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
