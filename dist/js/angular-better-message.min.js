!function(){"use strict";angular.module("AngularBetterMessage",[])}(),function(){"use strict";var e=function(e){this.onClick=function(){if(!_.isUndefined(e.onClick)){var n=_.isUndefined(e.message)?null:e.message,s=_.isUndefined(e.state)?null:e.state,t=_.isUndefined(e.key)?null:e.key,a=_.isUndefined(e.data)?null:e.data;e.onClick({message:n,state:s,key:t,data:a})}e.close()}};e.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",e)}(),function(){"use strict";var e=function(e,n,s,t,a,o){return{restrict:"EA",scope:{api:"=",message:"=",state:"=",key:"=",data:"=",message_icon_class:"=messageIconClass",prompt:"=",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(n,i,l,c){var r=n.api||{};n.message_class=t,n.prompt_class=a;var d,u,p;n.is_visible=!1;var f,g=angular.element(e);r.close=function(){n.close()},r.update=function(){n.update()},n.close=function(){n.is_visible=!1},n.wait=function(){d=window.setInterval(function(){0===--n.count_down?(window.clearInterval(d),n.close()):n.wait()},1e3)},n.checkPosition=function(){n.is_visible&&!i.hasClass("detached")&&_.isNull(i[0].offsetParent)?u=window.setInterval(n.checkPosition,100):(p=i[0].getBoundingClientRect().top,n.updateDetached())},n.updateDetached=function(){window.clearInterval(u),!i.hasClass("detached")&&0>=p&&e.pageYOffset>0?(f=e.pageYOffset,i.addClass("detached")):i.hasClass("detached")&&!_.isUndefined(f)&&e.pageYOffset<=f&&i.removeClass("detached")},n.update=function(){n.is_visible=!0,n.fixed_position_on_scroll&&n.checkPosition(),n.count_down=_.parseInt(n.display_seconds),window.clearInterval(d),_.isUndefined(n.count_down)||0===n.count_down||(n.wait(),n.outer_prompt_class=o)},n.$watch("display_seconds",function(e){_.isUndefined(e)||""===e||(n.display_seconds=_.parseInt(e),n.count_down=_.parseInt(e))}),n.$watch("message",function(e){var t=angular.element(i[0].querySelector(".angular-better-message-wrapper"));if(t.empty(),_.isUndefined(e)||""===e)window.clearInterval(d),n.close();else{var a=s("<span>"+e+"</span>")(n.$parent.$parent);t.append(a),n.update()}}),n.$watch("prompt",function(e){_.isUndefined(e)||""===e?n.outer_prompt_class="":n.outer_prompt_class=o}),n.fixed_position_on_scroll&&g.on("scroll",function(){_.isUndefined(n.message)||""===n.message||n.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};e.$inject=["$window","$timeout","$compile","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",e)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWRpcmVjdGl2ZS5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2Utc2V0dGluZ3MuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkcyIsInRoaXMiLCJvbkNsaWNrIiwiXyIsImlzVW5kZWZpbmVkIiwibWVzc2FnZSIsInN0YXRlIiwia2V5IiwiZGF0YSIsImNsb3NlIiwiJGluamVjdCIsImRpcmVjdGl2ZSIsIiR3aW5kb3ciLCIkdGltZW91dCIsIiRjb21waWxlIiwiTUVTU0FHRV9DTEFTUyIsIlBST01QVF9DTEFTUyIsIkhBU19QUk9NUFRfQ0xBU1MiLCJyZXN0cmljdCIsInNjb3BlIiwiYXBpIiwibWVzc2FnZV9pY29uX2NsYXNzIiwicHJvbXB0IiwicHJvbXB0X2J1dHRvbl9jbGFzcyIsInByb21wdF9pY29uX2NsYXNzIiwiZGlzcGxheV9zZWNvbmRzIiwic2hvd19jb3VudF9kb3duIiwiZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsIm1lc3NhZ2VfY2xhc3MiLCJwcm9tcHRfY2xhc3MiLCJ3YWl0X3RpbWVyIiwiZWxlbWVudF92aXNpYmxlX3RpbWVyIiwiZWxlbWVudF90b3AiLCJpc192aXNpYmxlIiwiZGV0YWNoZWRfcG9zaXRpb24iLCJ3aW5kb3dfZWxlbWVudCIsInVwZGF0ZSIsIndhaXQiLCJ3aW5kb3ciLCJzZXRJbnRlcnZhbCIsImNvdW50X2Rvd24iLCJjbGVhckludGVydmFsIiwiY2hlY2tQb3NpdGlvbiIsImhhc0NsYXNzIiwiaXNOdWxsIiwib2Zmc2V0UGFyZW50IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwidXBkYXRlRGV0YWNoZWQiLCJwYWdlWU9mZnNldCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJwYXJzZUludCIsIm91dGVyX3Byb21wdF9jbGFzcyIsIiR3YXRjaCIsInZhbCIsIndyYXBwZXIiLCJxdWVyeVNlbGVjdG9yIiwiZW1wdHkiLCJjb21waWxlZF9tZXNzYWdlIiwiJHBhcmVudCIsImFwcGVuZCIsIm9uIiwicmVwbGFjZSIsInRlbXBsYXRlVXJsIiwiY29uc3RhbnQiXSwibWFwcGluZ3MiOiJDQUFBLFdBRUEsWUFNQUEsU0FBQUMsT0FBQSw4QkNSQSxXQUVBLFlBTUEsSUFBQUMsR0FBQSxTQUFBQyxHQUtBQyxLQUFBQyxRQUFBLFdBQ0EsSUFBQUMsRUFBQUMsWUFBQUosRUFBQUUsU0FBQSxDQUVBLEdBQUFHLEdBQUFGLEVBQUFDLFlBQUFKLEVBQUFLLFNBQUEsS0FBQUwsRUFBQUssUUFDQUMsRUFBQUgsRUFBQUMsWUFBQUosRUFBQU0sT0FBQSxLQUFBTixFQUFBTSxNQUNBQyxFQUFBSixFQUFBQyxZQUFBSixFQUFBTyxLQUFBLEtBQUFQLEVBQUFPLElBQ0FDLEVBQUFMLEVBQUFDLFlBQUFKLEVBQUFRLE1BQUEsS0FBQVIsRUFBQVEsSUFFQVIsR0FBQUUsU0FBQUcsUUFBQUEsRUFBQUMsTUFBQUEsRUFBQUMsSUFBQUEsRUFBQUMsS0FBQUEsSUFFQVIsRUFBQVMsU0FJQVYsR0FBQVcsU0FBQSxVQUVBYixRQUFBQyxPQUFBLHdCQUFBQyxXQUFBLDJCQUFBQSxNQzdCQSxXQUVBLFlBTUEsSUFBQVksR0FBQSxTQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxFQUNBQyxHQWVBLE9BQ0FDLFNBQUEsS0FDQUMsT0FDQUMsSUFBQSxJQUNBZixRQUFBLElBQ0FDLE1BQUEsSUFDQUMsSUFBQSxJQUNBQyxLQUFBLElBQ0FhLG1CQUFBLG9CQUNBQyxPQUFBLElBQ0FDLG9CQUFBLHFCQUNBQyxrQkFBQSxtQkFDQUMsZ0JBQUEsa0JBQ0FDLGdCQUFBLGlCQUNBQyx5QkFBQSx5QkFDQXpCLFFBQUEsa0JBRUFILFdBQUEsbUNBQ0E2QixLQUFBLFNBQUFULEVBQUFVLEVBQUFDLEVBQUEvQixHQUVBLEdBQUFxQixHQUFBRCxFQUFBQyxPQUdBRCxHQUFBWSxjQUFBaEIsRUFDQUksRUFBQWEsYUFBQWhCLENBR0EsSUFBQWlCLEdBQ0FDLEVBQ0FDLENBQ0FoQixHQUFBaUIsWUFBQSxDQUdBLElBQUFDLEdBQ0FDLEVBQUF6QyxRQUFBZ0MsUUFBQWpCLEVBTUFRLEdBQUFYLE1BQUEsV0FDQVUsRUFBQVYsU0FHQVcsRUFBQW1CLE9BQUEsV0FDQXBCLEVBQUFvQixVQVVBcEIsRUFBQVYsTUFBQSxXQUNBVSxFQUFBaUIsWUFBQSxHQU1BakIsRUFBQXFCLEtBQUEsV0FXQVAsRUFBQVEsT0FBQUMsWUFBQSxXQUVBLE1BQUF2QixFQUFBd0IsWUFDQUYsT0FBQUcsY0FBQVgsR0FDQWQsRUFBQVYsU0FFQVUsRUFBQXFCLFFBRUEsTUFNQXJCLEVBQUEwQixjQUFBLFdBR0ExQixFQUFBaUIsYUFBQVAsRUFBQWlCLFNBQUEsYUFBQTNDLEVBQUE0QyxPQUFBbEIsRUFBQSxHQUFBbUIsY0FHQWQsRUFBQU8sT0FBQUMsWUFBQXZCLEVBQUEwQixjQUFBLE1BSUFWLEVBQUFOLEVBQUEsR0FBQW9CLHdCQUFBQyxJQUdBL0IsRUFBQWdDLG1CQU9BaEMsRUFBQWdDLGVBQUEsV0FHQVYsT0FBQUcsY0FBQVYsSUFHQUwsRUFBQWlCLFNBQUEsYUFBQSxHQUFBWCxHQUFBdkIsRUFBQXdDLFlBQUEsR0FDQWYsRUFBQXpCLEVBQUF3QyxZQUNBdkIsRUFBQXdCLFNBQUEsYUFHQXhCLEVBQUFpQixTQUFBLGNBQUEzQyxFQUFBQyxZQUFBaUMsSUFBQXpCLEVBQUF3QyxhQUFBZixHQUVBUixFQUFBeUIsWUFBQSxhQU9BbkMsRUFBQW9CLE9BQUEsV0FHQXBCLEVBQUFpQixZQUFBLEVBR0FqQixFQUFBUSwwQkFDQVIsRUFBQTBCLGdCQUlBMUIsRUFBQXdCLFdBQUF4QyxFQUFBb0QsU0FBQXBDLEVBQUFNLGlCQUdBZ0IsT0FBQUcsY0FBQVgsR0FHQTlCLEVBQUFDLFlBQUFlLEVBQUF3QixhQUFBLElBQUF4QixFQUFBd0IsYUFHQXhCLEVBQUFxQixPQUdBckIsRUFBQXFDLG1CQUFBdkMsSUFRQUUsRUFBQXNDLE9BQUEsa0JBQUEsU0FBQUMsR0FFQXZELEVBQUFDLFlBQUFzRCxJQUFBLEtBQUFBLElBQ0F2QyxFQUFBTSxnQkFBQXRCLEVBQUFvRCxTQUFBRyxHQUNBdkMsRUFBQXdCLFdBQUF4QyxFQUFBb0QsU0FBQUcsTUFJQXZDLEVBQUFzQyxPQUFBLFVBQUEsU0FBQUMsR0FDQSxHQUFBQyxHQUFBOUQsUUFBQWdDLFFBQUFBLEVBQUEsR0FBQStCLGNBQUEsbUNBR0EsSUFGQUQsRUFBQUUsUUFFQTFELEVBQUFDLFlBQUFzRCxJQUFBLEtBQUFBLEVBTUFqQixPQUFBRyxjQUFBWCxHQUNBZCxFQUFBVixZQVBBLENBQ0EsR0FBQXFELEdBQUFoRCxFQUFBLFNBQUE0QyxFQUFBLFdBQUF2QyxFQUFBNEMsUUFBQUEsUUFDQUosR0FBQUssT0FBQUYsR0FFQTNDLEVBQUFvQixZQU9BcEIsRUFBQXNDLE9BQUEsU0FBQSxTQUFBQyxHQUdBdkQsRUFBQUMsWUFBQXNELElBQUEsS0FBQUEsRUFHQXZDLEVBQUFxQyxtQkFBQSxHQUZBckMsRUFBQXFDLG1CQUFBdkMsSUFZQUUsRUFBQVEsMEJBQ0FXLEVBQUEyQixHQUFBLFNBQUEsV0FDQTlELEVBQUFDLFlBQUFlLEVBQUFkLFVBQUEsS0FBQWMsRUFBQWQsU0FHQWMsRUFBQTBCLG1CQUtBcUIsU0FBQSxFQUNBQyxZQUFBLG9DQUlBeEQsR0FBQUQsU0FDQSxVQUNBLFdBQ0EsV0FDQSwrQkFDQSxzQ0FDQSwyQ0FHQWIsUUFBQUMsT0FBQSx3QkFDQWEsVUFBQSx1QkFBQUEsTUMzUEEsV0FFQSxZQU1BZCxTQUFBQyxPQUFBLHdCQUNBc0UsU0FBQSwrQkFBQSxXQUNBQSxTQUFBLHNDQUFBLFVBQ0FBLFNBQUEsMENBQUEiLCJmaWxlIjoiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2VcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScsIFtdKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2UgY29udHJvbGxlclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogb25DbGlja1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoJHMub25DbGljaykpIHtcblxuICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gIV8uaXNVbmRlZmluZWQoJHMubWVzc2FnZSkgPyAkcy5tZXNzYWdlIDogbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIgc3RhdGUgPSAhXy5pc1VuZGVmaW5lZCgkcy5zdGF0ZSkgPyAkcy5zdGF0ZSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIGtleSA9ICFfLmlzVW5kZWZpbmVkKCRzLmtleSkgPyAkcy5rZXkgOiBudWxsO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0gIV8uaXNVbmRlZmluZWQoJHMuZGF0YSkgPyAkcy5kYXRhIDogbnVsbDtcblxuICAgICAgICAgICAgICAgICRzLm9uQ2xpY2soe21lc3NhZ2U6IG1lc3NhZ2UsIHN0YXRlOiBzdGF0ZSwga2V5OiBrZXksIGRhdGE6IGRhdGF9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzLmNsb3NlKCk7XG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJ107XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnKS5jb250cm9sbGVyKCdBbmd1bGFyQmV0dGVyTWVzc2FnZUN0cmwnLCBjb250cm9sbGVyKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbigpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gYW5ndWxhci1iZXR0ZXItbWVzc2FnZSBkaXJlY3RpdmVcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIHZhciBkaXJlY3RpdmUgPSBmdW5jdGlvbihcbiAgICAgICAgJHdpbmRvdyxcbiAgICAgICAgJHRpbWVvdXQsXG4gICAgICAgICRjb21waWxlLFxuICAgICAgICBNRVNTQUdFX0NMQVNTLFxuICAgICAgICBQUk9NUFRfQ0xBU1MsXG4gICAgICAgIEhBU19QUk9NUFRfQ0xBU1NcbiAgICApIHtcblxuICAgICAgICBmdW5jdGlvbiBnZXRQb3NpdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgeFBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIHZhciB5UG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICB3aGlsZShlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgeFBvc2l0aW9uICs9IChlbGVtZW50Lm9mZnNldExlZnQgLSBlbGVtZW50LnNjcm9sbExlZnQgKyBlbGVtZW50LmNsaWVudExlZnQpO1xuICAgICAgICAgICAgICAgIHlQb3NpdGlvbiArPSAoZWxlbWVudC5vZmZzZXRUb3AgLSBlbGVtZW50LnNjcm9sbFRvcCArIGVsZW1lbnQuY2xpZW50VG9wKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geyB4OiB4UG9zaXRpb24sIHk6IHlQb3NpdGlvbiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBhcGk6ICAgICAgICAgICAgICAgICAgICBcIj1cIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBzdGF0ZTogICAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBrZXk6ICAgICAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBkYXRhOiAgICAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBtZXNzYWdlX2ljb25fY2xhc3M6ICAgICBcIj1tZXNzYWdlSWNvbkNsYXNzXCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAgICAgICAgICAgICAgICAgXCI9XCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0X2J1dHRvbl9jbGFzczogICAgXCI9cHJvbXB0QnV0dG9uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBwcm9tcHRfaWNvbl9jbGFzczogICAgICBcIj1wcm9tcHRJY29uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5X3NlY29uZHM6ICAgICAgICBcIj1kaXNwbGF5U2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIHNob3dfY291bnRfZG93bjogICAgICAgIFwiPXNob3dDb3VudERvd25cIixcbiAgICAgICAgICAgICAgICBmaXhlZF9wb3NpdGlvbl9vbl9zY3JvbGw6IFwiPWZpeGVkUG9zaXRpb25PblNjcm9sbFwiLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICAgICAgICAgICAgICAgIFwiJm9uUHJvbXB0Q2xpY2tcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsIGFzIGN0cmxcIixcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY29udHJvbGxlcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGFwaSA9IHNjb3BlLmFwaSB8fCB7fTtcblxuICAgICAgICAgICAgICAgIC8vIGNsYXNzZXNcbiAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlX2NsYXNzID0gTUVTU0FHRV9DTEFTUztcbiAgICAgICAgICAgICAgICBzY29wZS5wcm9tcHRfY2xhc3MgPSBQUk9NUFRfQ0xBU1M7XG5cbiAgICAgICAgICAgICAgICAvLyBjb250cm9sXG4gICAgICAgICAgICAgICAgdmFyIHdhaXRfdGltZXI7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRfdmlzaWJsZV90aW1lcjtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF90b3A7XG4gICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gZml4IG9uIHNjcm9sbFxuICAgICAgICAgICAgICAgIHZhciBkZXRhY2hlZF9wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgd2luZG93X2VsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdyk7XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gYXBpXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgYXBpLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGFwaS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyB1dGlsc1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGNsb3NlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB3YWl0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUud2FpdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vd2FpdF90aW1lciA9ICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICAvLyAgICBpZiAoLS1zY29wZS5jb3VudF9kb3duID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICAkdGltZW91dC5jYW5jZWwod2FpdF90aW1lcik7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgICAgc2NvcGUud2FpdCgpO1xuICAgICAgICAgICAgICAgICAgICAvLyAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vfSwgMTAwMCk7XG4gICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZXIgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgtLXNjb3BlLmNvdW50X2Rvd24gPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBjaGVja1Bvc2l0aW9uXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgdmlzaWJsZSAmIGlzIG5vdCBkZXRhY2hlZCAmIGlzIG5vdCByZWFkeVxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNfdmlzaWJsZSAmJiAhZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiBfLmlzTnVsbChlbGVtZW50WzBdLm9mZnNldFBhcmVudCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2FpdFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF92aXNpYmxlX3RpbWVyID0gd2luZG93LnNldEludGVydmFsKHNjb3BlLmNoZWNrUG9zaXRpb24sIDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdldCBlbGVtZW50IHRvcCBvZmZzZXRcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnRfdG9wID0gZWxlbWVudFswXS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHVwZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlRGV0YWNoZWQoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB1cGRhdGVEZXRhY2hlZFxuICAgICAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZURldGFjaGVkID0gZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2FuY2VsIHRpbWVyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKGVsZW1lbnRfdmlzaWJsZV90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyBub3QgZGV0YWNoZWQgYW5kIGlzIGF0IHRoZSB0b3Agb2Ygdmlld3BvcnQsIHRoZW4gZGV0YWNoXG4gICAgICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiBlbGVtZW50X3RvcCA8PSAwICYmICR3aW5kb3cucGFnZVlPZmZzZXQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhY2hlZF9wb3NpdGlvbiA9ICR3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdkZXRhY2hlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgZGV0YWNoZWQgYW5kIGlzIGF0IG9yIGFib3ZlIGRldGFjaGVkIHBvc2l0aW9uLCB0aGVuIGF0dGFjaFxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmICFfLmlzVW5kZWZpbmVkKGRldGFjaGVkX3Bvc2l0aW9uKSAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0IDw9IGRldGFjaGVkX3Bvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2RldGFjaGVkX3Bvc2l0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnZGV0YWNoZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB1cGRhdGVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdmlzaWJpbGl0eVxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBjb3VudCBkb3duXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50X2Rvd24gPSBfLnBhcnNlSW50KHNjb3BlLmRpc3BsYXlfc2Vjb25kcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbGVhckludGVydmFsKHdhaXRfdGltZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGF1dG8gY2xvc2UgYWZ0ZXIgaW50ZXJ2YWxcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNjb3BlLmNvdW50X2Rvd24pICYmIHNjb3BlLmNvdW50X2Rvd24gIT09IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnQgd2FpdFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUud2FpdCgpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXQgb3V0ZXIgcHJvbXQgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IEhBU19QUk9NUFRfQ0xBU1M7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIHdhdGNoZXJzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdkaXNwbGF5X3NlY29uZHMnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmRpc3BsYXlfc2Vjb25kcyA9IF8ucGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50X2Rvd24gPSBfLnBhcnNlSW50KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnbWVzc2FnZScsIGZ1bmN0aW9uKHZhbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgd3JhcHBlciA9IGFuZ3VsYXIuZWxlbWVudChlbGVtZW50WzBdLnF1ZXJ5U2VsZWN0b3IoJy5hbmd1bGFyLWJldHRlci1tZXNzYWdlLXdyYXBwZXInKSk7XG4gICAgICAgICAgICAgICAgICAgIHdyYXBwZXIuZW1wdHkoKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb21waWxlZF9tZXNzYWdlID0gJGNvbXBpbGUoJzxzcGFuPicgKyB2YWwgKyAnPC9zcGFuPicpKHNjb3BlLiRwYXJlbnQuJHBhcmVudCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3cmFwcGVyLmFwcGVuZChjb21waWxlZF9tZXNzYWdlKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xlYXJJbnRlcnZhbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgncHJvbXB0JywgZnVuY3Rpb24odmFsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0IG91dGVyIHByb210IGNsYXNzXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gSEFTX1BST01QVF9DTEFTUztcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyBldmVudHNcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICAvLyB3aW5kb3cgc2Nyb2xsXG5cbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgICAgIHdpbmRvd19lbGVtZW50Lm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzY29wZS5tZXNzYWdlKSAmJiBzY29wZS5tZXNzYWdlICE9PSBcIlwiKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNoZWNrUG9zaXRpb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHJlcGxhY2U6IHRydWUsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2h0bWwvYW5ndWxhci1iZXR0ZXItbWVzc2FnZS5odG1sJ1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBkaXJlY3RpdmUuJGluamVjdCA9IFtcbiAgICAgICAgJyR3aW5kb3cnLFxuICAgICAgICAnJHRpbWVvdXQnLFxuICAgICAgICAnJGNvbXBpbGUnLFxuICAgICAgICAnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9DTEFTUycsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX1BST01QVF9DTEFTUycsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0hBU19QUk9NUFRfQ0xBU1MnXG4gICAgXTtcblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScpXG4gICAgICAgIC5kaXJlY3RpdmUoJ2FuZ3VsYXJCZXR0ZXJNZXNzYWdlJywgZGlyZWN0aXZlKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2Ugc2V0dGluZ3NcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScpXG4gICAgICAgIC5jb25zdGFudCgnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9DTEFTUycsICAgICAgICAgICAgICAgXCJtZXNzYWdlXCIpXG4gICAgICAgIC5jb25zdGFudCgnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9QUk9NUFRfQ0xBU1MnLCAgICAgICAgXCJwcm9tcHRcIilcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0hBU19QUk9NUFRfQ0xBU1MnLCAgICBcImhhcy1wcm9tcHRcIik7XG5cbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
