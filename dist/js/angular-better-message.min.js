!function(){"use strict";angular.module("AngularBetterMessage",[])}(),function(){"use strict";var e=function(e){this.onClick=function(){if(!_.isUndefined(e.onClick)){var s=_.isUndefined(e.message)?null:e.message,n=_.isUndefined(e.state)?null:e.state,t=_.isUndefined(e.key)?null:e.key,a=_.isUndefined(e.data)?null:e.data;e.onClick({message:s,state:n,key:t,data:a})}e.close()}};e.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",e)}(),function(){"use strict";var e=function(e,s,n,t,a){return{restrict:"EA",scope:{api:"=",message:"=",state:"=",key:"=",data:"=",message_icon_class:"=messageIconClass",prompt:"=",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(o,i,c,l){var d=o.api||{};o.message_class=n,o.prompt_class=t;var r,u,p;o.is_visible=!1;var f,g=angular.element(e);d.close=function(){o.close()},d.update=function(){o.update()},o.close=function(){o.is_visible=!1},o.wait=function(){r=s(function(){0===--o.count_down?(s.cancel(r),o.close()):o.wait()},1e3)},o.checkPosition=function(){o.is_visible&&!i.hasClass("detached")&&_.isNull(i[0].offsetParent)?u=s(o.checkPosition,100):(p=i[0].getBoundingClientRect().top,o.updateDetached())},o.updateDetached=function(){s.cancel(u),!i.hasClass("detached")&&0>=p&&e.pageYOffset>0?(f=e.pageYOffset,i.addClass("detached")):i.hasClass("detached")&&!_.isUndefined(f)&&e.pageYOffset<=f&&i.removeClass("detached")},o.update=function(){o.is_visible=!0,o.fixed_position_on_scroll&&o.checkPosition(),o.count_down=_.parseInt(o.display_seconds),s.cancel(r),_.isUndefined(o.count_down)||0===o.count_down||(o.wait(),o.outer_prompt_class=a)},o.$watch("display_seconds",function(e){_.isUndefined(e)||""===e||(o.display_seconds=_.parseInt(e),o.count_down=_.parseInt(e))}),o.$watch("message",function(e){_.isUndefined(e)||""===e?(s.cancel(r),o.close()):o.update()}),o.$watch("prompt",function(e){_.isUndefined(e)||""===e?o.outer_prompt_class="":o.outer_prompt_class=a}),o.fixed_position_on_scroll&&g.on("scroll",function(){_.isUndefined(o.message)||""===o.message||o.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};e.$inject=["$window","$timeout","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",e)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWRpcmVjdGl2ZS5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2Utc2V0dGluZ3MuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkcyIsInRoaXMiLCJvbkNsaWNrIiwiXyIsImlzVW5kZWZpbmVkIiwibWVzc2FnZSIsInN0YXRlIiwia2V5IiwiZGF0YSIsImNsb3NlIiwiJGluamVjdCIsImRpcmVjdGl2ZSIsIiR3aW5kb3ciLCIkdGltZW91dCIsIk1FU1NBR0VfQ0xBU1MiLCJQUk9NUFRfQ0xBU1MiLCJIQVNfUFJPTVBUX0NMQVNTIiwicmVzdHJpY3QiLCJzY29wZSIsImFwaSIsIm1lc3NhZ2VfaWNvbl9jbGFzcyIsInByb21wdCIsInByb21wdF9idXR0b25fY2xhc3MiLCJwcm9tcHRfaWNvbl9jbGFzcyIsImRpc3BsYXlfc2Vjb25kcyIsInNob3dfY291bnRfZG93biIsImZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCIsImxpbmsiLCJlbGVtZW50IiwiYXR0cnMiLCJtZXNzYWdlX2NsYXNzIiwicHJvbXB0X2NsYXNzIiwid2FpdF90aW1lciIsImVsZW1lbnRfdmlzaWJsZV90aW1lciIsImVsZW1lbnRfdG9wIiwiaXNfdmlzaWJsZSIsImRldGFjaGVkX3Bvc2l0aW9uIiwid2luZG93X2VsZW1lbnQiLCJ1cGRhdGUiLCJ3YWl0IiwiY291bnRfZG93biIsImNhbmNlbCIsImNoZWNrUG9zaXRpb24iLCJoYXNDbGFzcyIsImlzTnVsbCIsIm9mZnNldFBhcmVudCIsImdldEJvdW5kaW5nQ2xpZW50UmVjdCIsInRvcCIsInVwZGF0ZURldGFjaGVkIiwicGFnZVlPZmZzZXQiLCJhZGRDbGFzcyIsInJlbW92ZUNsYXNzIiwicGFyc2VJbnQiLCJvdXRlcl9wcm9tcHRfY2xh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QyxFQUFBc0IsV0FBQXJDLEVBQUFpRCxTQUFBRyxNQUlBckMsRUFBQW9DLE9BQUEsVUFBQSxTQUFBQyxHQUVBcEQsRUFBQUMsWUFBQW1ELElBQUEsS0FBQUEsR0FHQTFDLEVBQUE0QixPQUFBVCxHQUNBZCxFQUFBVCxTQUhBUyxFQUFBb0IsV0FPQXBCLEVBQUFvQyxPQUFBLFNBQUEsU0FBQUMsR0FHQXBELEVBQUFDLFlBQUFtRCxJQUFBLEtBQUFBLEVBR0FyQyxFQUFBbUMsbUJBQUEsR0FGQW5DLEVBQUFtQyxtQkFBQXJDLElBWUFFLEVBQUFRLDBCQUNBVyxFQUFBbUIsR0FBQSxTQUFBLFdBQ0FyRCxFQUFBQyxZQUFBYyxFQUFBYixVQUFBLEtBQUFhLEVBQUFiLFNBR0FhLEVBQUF3QixtQkFLQWUsU0FBQSxFQUNBQyxZQUFBLG9DQUlBL0MsR0FBQUQsU0FDQSxVQUNBLFdBQ0EsK0JBQ0Esc0NBQ0EsMkNBR0FiLFFBQUFDLE9BQUEsd0JBQ0FhLFVBQUEsdUJBQUFBLE1DM09BLFdBRUEsWUFNQWQsU0FBQUMsT0FBQSx3QkFDQTZELFNBQUEsK0JBQUEsV0FDQUEsU0FBQSxzQ0FBQSxVQUNBQSxTQUFBLDBDQUFBIiwiZmlsZSI6ImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBBbmd1bGFyIEJldHRlciBNZXNzYWdlXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnLCBbXSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBBbmd1bGFyIEJldHRlciBNZXNzYWdlIGNvbnRyb2xsZXJcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIHZhciBjb250cm9sbGVyID0gZnVuY3Rpb24gKCRzKSB7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIG9uQ2xpY2tcbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub25DbGljayA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKCRzLm9uQ2xpY2spKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZSA9ICFfLmlzVW5kZWZpbmVkKCRzLm1lc3NhZ2UpID8gJHMubWVzc2FnZSA6IG51bGw7XG4gICAgICAgICAgICAgICAgdmFyIHN0YXRlID0gIV8uaXNVbmRlZmluZWQoJHMuc3RhdGUpID8gJHMuc3RhdGUgOiBudWxsO1xuICAgICAgICAgICAgICAgIHZhciBrZXkgPSAhXy5pc1VuZGVmaW5lZCgkcy5rZXkpID8gJHMua2V5IDogbnVsbDtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9ICFfLmlzVW5kZWZpbmVkKCRzLmRhdGEpID8gJHMuZGF0YSA6IG51bGw7XG5cbiAgICAgICAgICAgICAgICAkcy5vbkNsaWNrKHttZXNzYWdlOiBtZXNzYWdlLCBzdGF0ZTogc3RhdGUsIGtleToga2V5LCBkYXRhOiBkYXRhfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZSddO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJykuY29udHJvbGxlcignQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsJywgY29udHJvbGxlcik7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIGFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UgZGlyZWN0aXZlXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YXIgZGlyZWN0aXZlID0gZnVuY3Rpb24oXG4gICAgICAgICR3aW5kb3csXG4gICAgICAgICR0aW1lb3V0LFxuICAgICAgICBNRVNTQUdFX0NMQVNTLFxuICAgICAgICBQUk9NUFRfQ0xBU1MsXG4gICAgICAgIEhBU19QUk9NUFRfQ0xBU1NcbiAgICApIHtcblxuICAgICAgICBmdW5jdGlvbiBnZXRQb3NpdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgeFBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIHZhciB5UG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICB3aGlsZShlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgeFBvc2l0aW9uICs9IChlbGVtZW50Lm9mZnNldExlZnQgLSBlbGVtZW50LnNjcm9sbExlZnQgKyBlbGVtZW50LmNsaWVudExlZnQpO1xuICAgICAgICAgICAgICAgIHlQb3NpdGlvbiArPSAoZWxlbWVudC5vZmZzZXRUb3AgLSBlbGVtZW50LnNjcm9sbFRvcCArIGVsZW1lbnQuY2xpZW50VG9wKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geyB4OiB4UG9zaXRpb24sIHk6IHlQb3NpdGlvbiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBhcGk6ICAgICAgICAgICAgICAgICAgICBcIj1cIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlOiAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBzdGF0ZTogICAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBrZXk6ICAgICAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBkYXRhOiAgICAgICAgICAgICAgICAgICBcIj1cIiwgLy8gd2lsbCBiZSBwYXNzZWQgYmFjayBvbiBldmVudHNcbiAgICAgICAgICAgICAgICBtZXNzYWdlX2ljb25fY2xhc3M6ICAgICBcIj1tZXNzYWdlSWNvbkNsYXNzXCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAgICAgICAgICAgICAgICAgXCI9XCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0X2J1dHRvbl9jbGFzczogICAgXCI9cHJvbXB0QnV0dG9uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBwcm9tcHRfaWNvbl9jbGFzczogICAgICBcIj1wcm9tcHRJY29uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5X3NlY29uZHM6ICAgICAgICBcIj1kaXNwbGF5U2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIHNob3dfY291bnRfZG93bjogICAgICAgIFwiPXNob3dDb3VudERvd25cIixcbiAgICAgICAgICAgICAgICBmaXhlZF9wb3NpdGlvbl9vbl9zY3JvbGw6IFwiPWZpeGVkUG9zaXRpb25PblNjcm9sbFwiLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICAgICAgICAgICAgICAgIFwiJm9uUHJvbXB0Q2xpY2tcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsIGFzIGN0cmxcIixcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY29udHJvbGxlcikge1xuXG4gICAgICAgICAgICAgICAgdmFyIGFwaSA9IHNjb3BlLmFwaSB8fCB7fTtcblxuICAgICAgICAgICAgICAgIC8vIGNsYXNzZXNcbiAgICAgICAgICAgICAgICBzY29wZS5tZXNzYWdlX2NsYXNzID0gTUVTU0FHRV9DTEFTUztcbiAgICAgICAgICAgICAgICBzY29wZS5wcm9tcHRfY2xhc3MgPSBQUk9NUFRfQ0xBU1M7XG5cbiAgICAgICAgICAgICAgICAvLyBjb250cm9sXG4gICAgICAgICAgICAgICAgdmFyIHdhaXRfdGltZXI7XG4gICAgICAgICAgICAgICAgdmFyIGVsZW1lbnRfdmlzaWJsZV90aW1lcjtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF90b3A7XG4gICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IGZhbHNlO1xuXG4gICAgICAgICAgICAgICAgLy8gZml4IG9uIHNjcm9sbFxuICAgICAgICAgICAgICAgIHZhciBkZXRhY2hlZF9wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgd2luZG93X2VsZW1lbnQgPSBhbmd1bGFyLmVsZW1lbnQoJHdpbmRvdyk7XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gYXBpXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgYXBpLmNsb3NlID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIGFwaS51cGRhdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlKCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyB1dGlsc1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGNsb3NlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB3YWl0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUud2FpdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZXIgPSAkdGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tc2NvcGUuY291bnRfZG93biA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBjaGVja1Bvc2l0aW9uXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgdmlzaWJsZSAmIGlzIG5vdCBkZXRhY2hlZCAmIGlzIG5vdCByZWFkeVxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNfdmlzaWJsZSAmJiAhZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiBfLmlzTnVsbChlbGVtZW50WzBdLm9mZnNldFBhcmVudCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2FpdFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF92aXNpYmxlX3RpbWVyID0gJHRpbWVvdXQoc2NvcGUuY2hlY2tQb3NpdGlvbiwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGVsZW1lbnQgdG9wIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF90b3AgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGVEZXRhY2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHVwZGF0ZURldGFjaGVkXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlRGV0YWNoZWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGVsZW1lbnRfdmlzaWJsZV90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyBub3QgZGV0YWNoZWQgYW5kIGlzIGF0IHRoZSB0b3Agb2Ygdmlld3BvcnQsIHRoZW4gZGV0YWNoXG4gICAgICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiBlbGVtZW50X3RvcCA8PSAwICYmICR3aW5kb3cucGFnZVlPZmZzZXQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhY2hlZF9wb3NpdGlvbiA9ICR3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdkZXRhY2hlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgZGV0YWNoZWQgYW5kIGlzIGF0IG9yIGFib3ZlIGRldGFjaGVkIHBvc2l0aW9uLCB0aGVuIGF0dGFjaFxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmICFfLmlzVW5kZWZpbmVkKGRldGFjaGVkX3Bvc2l0aW9uKSAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0IDw9IGRldGFjaGVkX3Bvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2RldGFjaGVkX3Bvc2l0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnZGV0YWNoZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB1cGRhdGVcbiAgICAgICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICAgICBzY29wZS51cGRhdGUgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgdmlzaWJpbGl0eVxuICAgICAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBwb3NpdGlvblxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyByZXNldCBjb3VudCBkb3duXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50X2Rvd24gPSBfLnBhcnNlSW50KHNjb3BlLmRpc3BsYXlfc2Vjb25kcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc3RvcCB0aW1lb3V0XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh3YWl0X3RpbWVyKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBhdXRvIGNsb3NlIGFmdGVyIGludGVydmFsXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZChzY29wZS5jb3VudF9kb3duKSAmJiBzY29wZS5jb3VudF9kb3duICE9PSAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0IHdhaXRcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndhaXQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IG91dGVyIHByb210IGNsYXNzXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBIQVNfUFJPTVBUX0NMQVNTO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyB3YXRjaGVyc1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIHNjb3BlLiR3YXRjaCgnZGlzcGxheV9zZWNvbmRzJywgZnVuY3Rpb24odmFsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5kaXNwbGF5X3NlY29uZHMgPSBfLnBhcnNlSW50KHZhbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jb3VudF9kb3duID0gXy5wYXJzZUludCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ21lc3NhZ2UnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLnVwZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHdhaXRfdGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdwcm9tcHQnLCBmdW5jdGlvbih2YWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzZXQgb3V0ZXIgcHJvbXQgY2xhc3NcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsICE9PSBcIlwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBIQVNfUFJPTVBUX0NMQVNTO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUub3V0ZXJfcHJvbXB0X2NsYXNzID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgICAgICAgICAgICAgIC8vIGV2ZW50c1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8vIHdpbmRvdyBzY3JvbGxcblxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5maXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93X2VsZW1lbnQub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHNjb3BlLm1lc3NhZ2UpICYmIHNjb3BlLm1lc3NhZ2UgIT09IFwiXCIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIHBvc2l0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcmVwbGFjZTogdHJ1ZSxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnaHRtbC9hbmd1bGFyLWJldHRlci1tZXNzYWdlLmh0bWwnXG4gICAgICAgIH07XG4gICAgfTtcblxuICAgIGRpcmVjdGl2ZS4kaW5qZWN0ID0gW1xuICAgICAgICAnJHdpbmRvdycsXG4gICAgICAgICckdGltZW91dCcsXG4gICAgICAgICdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0NMQVNTJyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfUFJPTVBUX0NMQVNTJyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfSEFTX1BST01QVF9DTEFTUydcbiAgICBdO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJylcbiAgICAgICAgLmRpcmVjdGl2ZSgnYW5ndWxhckJldHRlck1lc3NhZ2UnLCBkaXJlY3RpdmUpO1xuXG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcblxuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgLy8gQW5ndWxhciBCZXR0ZXIgTWVzc2FnZSBzZXR0aW5nc1xuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJylcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX0NMQVNTJywgICAgICAgICAgICAgICBcIm1lc3NhZ2VcIilcbiAgICAgICAgLmNvbnN0YW50KCdBTkdVTEFSX0JFVFRFUl9NRVNTQUdFX1BST01QVF9DTEFTUycsICAgICAgICBcInByb21wdFwiKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfSEFTX1BST01QVF9DTEFTUycsICAgIFwiaGFzLXByb21wdFwiKTtcblxufSkoKTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
