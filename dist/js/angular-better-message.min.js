!function(){"use strict";angular.module("AngularBetterMessage",[])}(),function(){"use strict";var e=function(e){this.onClick=function(){_.isUndefined(e.onClick)||e.onClick(),e.close()}};e.$inject=["$scope"],angular.module("AngularBetterMessage").controller("AngularBetterMessageCtrl",e)}(),function(){"use strict";var e=function(e,s,t,n,o){return{restrict:"EA",scope:{state:"=state",message:"=message",message_icon_class:"=messageIconClass",prompt:"=prompt",prompt_button_class:"=promptButtonClass",prompt_icon_class:"=promptIconClass",display_seconds:"=displaySeconds",show_count_down:"=showCountDown",fixed_position_on_scroll:"=fixedPositionOnScroll",onClick:"&onPromptClick"},controller:"AngularBetterMessageCtrl as ctrl",link:function(a,c,i,l){a.message_class=t,a.prompt_class=n;var r,d,u;a.is_visible=!1;var p,f=angular.element(e);a.close=function(){a.is_visible=!1},a.wait=function(){r=s(function(){0===--a.count_down?(s.cancel(r),a.close()):a.wait()},1e3)},a.checkPosition=function(){a.is_visible&&!c.hasClass("detached")&&_.isNull(c[0].offsetParent)?d=s(a.checkPosition,100):(u=c[0].getBoundingClientRect().top,a.updateDetached())},a.updateDetached=function(){s.cancel(d),!c.hasClass("detached")&&0>=u&&e.pageYOffset>0?(p=e.pageYOffset,c.addClass("detached")):c.hasClass("detached")&&!_.isUndefined(p)&&e.pageYOffset<=p&&c.removeClass("detached")},a.$watch("display_seconds",function(e){_.isUndefined(e)||""===e||(a.display_seconds=_.parseInt(e),a.count_down=_.parseInt(e))}),a.$watch("message",function(e){_.isUndefined(e)||""===e?(s.cancel(r),a.close()):(a.is_visible=!0,a.fixed_position_on_scroll&&a.checkPosition(),a.count_down=_.parseInt(a.display_seconds),s.cancel(r),_.isUndefined(a.count_down)||0===a.count_down||(a.wait(),a.outer_prompt_class=o))}),a.$watch("prompt",function(e){a.outer_prompt_class=_.isUndefined(e)||""===e?"":o}),a.fixed_position_on_scroll&&f.on("scroll",function(){_.isUndefined(a.message)||""===a.message||a.checkPosition()})},replace:!0,templateUrl:"html/angular-better-message.html"}};e.$inject=["$window","$timeout","ANGULAR_BETTER_MESSAGE_CLASS","ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS"],angular.module("AngularBetterMessage").directive("angularBetterMessage",e)}(),function(){"use strict";angular.module("AngularBetterMessage").constant("ANGULAR_BETTER_MESSAGE_CLASS","message").constant("ANGULAR_BETTER_MESSAGE_PROMPT_CLASS","prompt").constant("ANGULAR_BETTER_MESSAGE_HAS_PROMPT_CLASS","has-prompt")}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWNvbnRyb2xsZXIuanMiLCJhbmd1bGFyLWJldHRlci1tZXNzYWdlLWRpcmVjdGl2ZS5qcyIsImFuZ3VsYXItYmV0dGVyLW1lc3NhZ2Utc2V0dGluZ3MuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnRyb2xsZXIiLCIkcyIsInRoaXMiLCJvbkNsaWNrIiwiXyIsImlzVW5kZWZpbmVkIiwiY2xvc2UiLCIkaW5qZWN0IiwiZGlyZWN0aXZlIiwiJHdpbmRvdyIsIiR0aW1lb3V0IiwiTUVTU0FHRV9DTEFTUyIsIlBST01QVF9DTEFTUyIsIkhBU19QUk9NUFRfQ0xBU1MiLCJyZXN0cmljdCIsInNjb3BlIiwic3RhdGUiLCJtZXNzYWdlIiwibWVzc2FnZV9pY29uX2NsYXNzIiwicHJvbXB0IiwicHJvbXB0X2J1dHRvbl9jbGFzcyIsInByb21wdF9pY29uX2NsYXNzIiwiZGlzcGxheV9zZWNvbmRzIiwic2hvd19jb3VudF9kb3duIiwiZml4ZWRfcG9zaXRpb25fb25fc2Nyb2xsIiwibGluayIsImVsZW1lbnQiLCJhdHRycyIsIm1lc3NhZ2VfY2xhc3MiLCJwcm9tcHRfY2xhc3MiLCJ3YWl0X3RpbWVyIiwiZWxlbWVudF92aXNpYmxlX3RpbWVyIiwiZWxlbWVudF90b3AiLCJpc192aXNpYmxlIiwiZGV0YWNoZWRfcG9zaXRpb24iLCJ3aW5kb3dfZWxlbWVudCIsIndhaXQiLCJjb3VudF9kb3duIiwiY2FuY2VsIiwiY2hlY2tQb3NpdGlvbiIsImhhc0NsYXNzIiwiaXNOdWxsIiwib2Zmc2V0UGFyZW50IiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwidXBkYXRlRGV0YWNoZWQiLCJwYWdlWU9mZnNldCIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCIkd2F0Y2giLCJ2YWwiLCJwYXJzZUludCIsIm91dGVyX3Byb21wdF9jbGFzcyIsIm9uIiwicmVw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VixTQUFBQyxPQUFBLHdCQUNBeUQsU0FBQSwrQkFBQSxXQUNBQSxTQUFBLHNDQUFBLFVBQ0FBLFNBQUEsMENBQUEiLCJmaWxlIjoiYW5ndWxhci1iZXR0ZXItbWVzc2FnZS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2VcbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgIGFuZ3VsYXIubW9kdWxlKCdBbmd1bGFyQmV0dGVyTWVzc2FnZScsIFtdKTtcblxufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIEFuZ3VsYXIgQmV0dGVyIE1lc3NhZ2UgY29udHJvbGxlclxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHMpIHtcblxuICAgICAgICAvKipcbiAgICAgICAgICogb25DbGlja1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkNsaWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoJHMub25DbGljaykpIHtcbiAgICAgICAgICAgICAgICAkcy5vbkNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkcy5jbG9zZSgpO1xuICAgICAgICB9O1xuICAgIH07XG5cbiAgICBjb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZSddO1xuXG4gICAgYW5ndWxhci5tb2R1bGUoJ0FuZ3VsYXJCZXR0ZXJNZXNzYWdlJykuY29udHJvbGxlcignQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsJywgY29udHJvbGxlcik7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24oKSB7XG5cbiAgICBcInVzZSBzdHJpY3RcIjtcblxuICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAgIC8vIGFuZ3VsYXItYmV0dGVyLW1lc3NhZ2UgZGlyZWN0aXZlXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICB2YXIgZGlyZWN0aXZlID0gZnVuY3Rpb24oXG4gICAgICAgICR3aW5kb3csXG4gICAgICAgICR0aW1lb3V0LFxuICAgICAgICBNRVNTQUdFX0NMQVNTLFxuICAgICAgICBQUk9NUFRfQ0xBU1MsXG4gICAgICAgIEhBU19QUk9NUFRfQ0xBU1NcbiAgICApIHtcblxuICAgICAgICBmdW5jdGlvbiBnZXRQb3NpdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICB2YXIgeFBvc2l0aW9uID0gMDtcbiAgICAgICAgICAgIHZhciB5UG9zaXRpb24gPSAwO1xuXG4gICAgICAgICAgICB3aGlsZShlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgeFBvc2l0aW9uICs9IChlbGVtZW50Lm9mZnNldExlZnQgLSBlbGVtZW50LnNjcm9sbExlZnQgKyBlbGVtZW50LmNsaWVudExlZnQpO1xuICAgICAgICAgICAgICAgIHlQb3NpdGlvbiArPSAoZWxlbWVudC5vZmZzZXRUb3AgLSBlbGVtZW50LnNjcm9sbFRvcCArIGVsZW1lbnQuY2xpZW50VG9wKTtcbiAgICAgICAgICAgICAgICBlbGVtZW50ID0gZWxlbWVudC5vZmZzZXRQYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4geyB4OiB4UG9zaXRpb24sIHk6IHlQb3NpdGlvbiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgICAgICBzdGF0ZTogICAgICAgICAgICAgICAgICBcIj1zdGF0ZVwiLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICAgICAgICAgICAgICAgIFwiPW1lc3NhZ2VcIixcbiAgICAgICAgICAgICAgICBtZXNzYWdlX2ljb25fY2xhc3M6ICAgICBcIj1tZXNzYWdlSWNvbkNsYXNzXCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0OiAgICAgICAgICAgICAgICAgXCI9cHJvbXB0XCIsXG4gICAgICAgICAgICAgICAgcHJvbXB0X2J1dHRvbl9jbGFzczogICAgXCI9cHJvbXB0QnV0dG9uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBwcm9tcHRfaWNvbl9jbGFzczogICAgICBcIj1wcm9tcHRJY29uQ2xhc3NcIixcbiAgICAgICAgICAgICAgICBkaXNwbGF5X3NlY29uZHM6ICAgICAgICBcIj1kaXNwbGF5U2Vjb25kc1wiLFxuICAgICAgICAgICAgICAgIHNob3dfY291bnRfZG93bjogICAgICAgIFwiPXNob3dDb3VudERvd25cIixcbiAgICAgICAgICAgICAgICBmaXhlZF9wb3NpdGlvbl9vbl9zY3JvbGw6IFwiPWZpeGVkUG9zaXRpb25PblNjcm9sbFwiLFxuICAgICAgICAgICAgICAgIG9uQ2xpY2s6ICAgICAgICAgICAgICAgIFwiJm9uUHJvbXB0Q2xpY2tcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IFwiQW5ndWxhckJldHRlck1lc3NhZ2VDdHJsIGFzIGN0cmxcIixcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY29udHJvbGxlcikge1xuXG4gICAgICAgICAgICAgICAgLy8gY2xhc3Nlc1xuICAgICAgICAgICAgICAgIHNjb3BlLm1lc3NhZ2VfY2xhc3MgPSBNRVNTQUdFX0NMQVNTO1xuICAgICAgICAgICAgICAgIHNjb3BlLnByb21wdF9jbGFzcyA9IFBST01QVF9DTEFTUztcblxuICAgICAgICAgICAgICAgIC8vIGNvbnRyb2xcbiAgICAgICAgICAgICAgICB2YXIgd2FpdF90aW1lcjtcbiAgICAgICAgICAgICAgICB2YXIgZWxlbWVudF92aXNpYmxlX3RpbWVyO1xuICAgICAgICAgICAgICAgIHZhciBlbGVtZW50X3RvcDtcbiAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAvLyBmaXggb24gc2Nyb2xsXG4gICAgICAgICAgICAgICAgdmFyIGRldGFjaGVkX3Bvc2l0aW9uO1xuICAgICAgICAgICAgICAgIHZhciB3aW5kb3dfZWxlbWVudCA9IGFuZ3VsYXIuZWxlbWVudCgkd2luZG93KTtcblxuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAgICAgICAgICAgICAvLyB1dGlsc1xuICAgICAgICAgICAgICAgIC8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIGNsb3NlXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuaXNfdmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiB3YWl0XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUud2FpdCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHdhaXRfdGltZXIgPSAkdGltZW91dChmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKC0tc2NvcGUuY291bnRfZG93biA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh3YWl0X3RpbWVyKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS53YWl0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAgICAgKiBjaGVja1Bvc2l0aW9uXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUuY2hlY2tQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgdmlzaWJsZSAmIGlzIG5vdCBkZXRhY2hlZCAmIGlzIG5vdCByZWFkeVxuICAgICAgICAgICAgICAgICAgICBpZiAoc2NvcGUuaXNfdmlzaWJsZSAmJiAhZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiBfLmlzTnVsbChlbGVtZW50WzBdLm9mZnNldFBhcmVudCkpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2FpdFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF92aXNpYmxlX3RpbWVyID0gJHRpbWVvdXQoc2NvcGUuY2hlY2tQb3NpdGlvbiwgMTAwKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2V0IGVsZW1lbnQgdG9wIG9mZnNldFxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudF90b3AgPSBlbGVtZW50WzBdLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcDtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdXBkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS51cGRhdGVEZXRhY2hlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICAgICAqIHVwZGF0ZURldGFjaGVkXG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICAgICAgc2NvcGUudXBkYXRlRGV0YWNoZWQgPSBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjYW5jZWwgdGltZXJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGVsZW1lbnRfdmlzaWJsZV90aW1lcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZWxlbWVudCBpcyBub3QgZGV0YWNoZWQgYW5kIGlzIGF0IHRoZSB0b3Agb2Ygdmlld3BvcnQsIHRoZW4gZGV0YWNoXG4gICAgICAgICAgICAgICAgICAgIGlmICghZWxlbWVudC5oYXNDbGFzcygnZGV0YWNoZWQnKSAmJiBlbGVtZW50X3RvcCA8PSAwICYmICR3aW5kb3cucGFnZVlPZmZzZXQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZXRhY2hlZF9wb3NpdGlvbiA9ICR3aW5kb3cucGFnZVlPZmZzZXQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50LmFkZENsYXNzKCdkZXRhY2hlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaXMgZGV0YWNoZWQgYW5kIGlzIGF0IG9yIGFib3ZlIGRldGFjaGVkIHBvc2l0aW9uLCB0aGVuIGF0dGFjaFxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50Lmhhc0NsYXNzKCdkZXRhY2hlZCcpICYmICFfLmlzVW5kZWZpbmVkKGRldGFjaGVkX3Bvc2l0aW9uKSAmJiAkd2luZG93LnBhZ2VZT2Zmc2V0IDw9IGRldGFjaGVkX3Bvc2l0aW9uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2RldGFjaGVkX3Bvc2l0aW9uID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmVDbGFzcygnZGV0YWNoZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gd2F0Y2hlcnNcbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ2Rpc3BsYXlfc2Vjb25kcycsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICghXy5pc1VuZGVmaW5lZCh2YWwpICYmIHZhbCAhPT0gXCJcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuZGlzcGxheV9zZWNvbmRzID0gXy5wYXJzZUludCh2YWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2NvcGUuY291bnRfZG93biA9IF8ucGFyc2VJbnQodmFsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgc2NvcGUuJHdhdGNoKCdtZXNzYWdlJywgZnVuY3Rpb24odmFsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHZhbCkgJiYgdmFsICE9PSBcIlwiKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCB2aXNpYmlsaXR5XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5pc192aXNpYmxlID0gdHJ1ZTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29wZS5maXhlZF9wb3NpdGlvbl9vbl9zY3JvbGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJlc2V0IGNvdW50IGRvd25cbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLmNvdW50X2Rvd24gPSBfLnBhcnNlSW50KHNjb3BlLmRpc3BsYXlfc2Vjb25kcyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0b3AgdGltZW91dFxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHdhaXRfdGltZXIpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhdXRvIGNsb3NlIGFmdGVyIGludGVydmFsXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2NvcGUuY291bnRfZG93bikgJiYgc2NvcGUuY291bnRfZG93biAhPT0gMCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc3RhcnQgd2FpdFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLndhaXQoKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCBvdXRlciBwcm9tdCBjbGFzc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IEhBU19QUk9NUFRfQ0xBU1M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwod2FpdF90aW1lcik7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3Byb21wdCcsIGZ1bmN0aW9uKHZhbCkge1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNldCBvdXRlciBwcm9tdCBjbGFzc1xuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQodmFsKSAmJiB2YWwgIT09IFwiXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjb3BlLm91dGVyX3Byb21wdF9jbGFzcyA9IEhBU19QUk9NUFRfQ0xBU1M7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5vdXRlcl9wcm9tcHRfY2xhc3MgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gICAgICAgICAgICAgICAgLy8gZXZlbnRzXG4gICAgICAgICAgICAgICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4gICAgICAgICAgICAgICAgLy8gd2luZG93IHNjcm9sbFxuXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmZpeGVkX3Bvc2l0aW9uX29uX3Njcm9sbCkge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3dfZWxlbWVudC5vbignc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc2NvcGUubWVzc2FnZSkgJiYgc2NvcGUubWVzc2FnZSAhPT0gXCJcIikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2hlY2sgcG9zaXRpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY29wZS5jaGVja1Bvc2l0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXBsYWNlOiB0cnVlLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdodG1sL2FuZ3VsYXItYmV0dGVyLW1lc3NhZ2UuaHRtbCdcbiAgICAgICAgfTtcbiAgICB9O1xuXG4gICAgZGlyZWN0aXZlLiRpbmplY3QgPSBbXG4gICAgICAgICckd2luZG93JyxcbiAgICAgICAgJyR0aW1lb3V0JyxcbiAgICAgICAgJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfQ0xBU1MnLFxuICAgICAgICAnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9QUk9NUFRfQ0xBU1MnLFxuICAgICAgICAnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9IQVNfUFJPTVBUX0NMQVNTJ1xuICAgIF07XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnKVxuICAgICAgICAuZGlyZWN0aXZlKCdhbmd1bGFyQmV0dGVyTWVzc2FnZScsIGRpcmVjdGl2ZSk7XG5cbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuXG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG5cbiAgICAvLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgICAvLyBBbmd1bGFyIEJldHRlciBNZXNzYWdlIHNldHRpbmdzXG4gICAgLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnQW5ndWxhckJldHRlck1lc3NhZ2UnKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfQ0xBU1MnLCAgICAgICAgICAgICAgIFwibWVzc2FnZVwiKVxuICAgICAgICAuY29uc3RhbnQoJ0FOR1VMQVJfQkVUVEVSX01FU1NBR0VfUFJPTVBUX0NMQVNTJywgICAgICAgIFwicHJvbXB0XCIpXG4gICAgICAgIC5jb25zdGFudCgnQU5HVUxBUl9CRVRURVJfTUVTU0FHRV9IQVNfUFJPTVBUX0NMQVNTJywgICAgXCJoYXMtcHJvbXB0XCIpO1xuXG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9